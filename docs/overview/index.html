<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" type="image/x-icon" href="/NotifyBC/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title>Overview | NotifyBC</title><meta name="description" content="A versatile notification API server">
    <link rel="preload" href="/NotifyBC/assets/style-BwJoByYn.css" as="style"><link rel="stylesheet" href="/NotifyBC/assets/style-BwJoByYn.css">
    <link rel="modulepreload" href="/NotifyBC/assets/app-2XzYbNgn.js"><link rel="modulepreload" href="/NotifyBC/assets/index.html-DsxITOXD.js">
    <link rel="prefetch" href="/NotifyBC/assets/index.html-D3Z62HPx.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DOXq1MkH.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CUboZ974.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BnWb-TNz.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CdC9oQfr.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B6iv3haA.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B2Q2jjFM.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CWUE3spR.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-OpJqUfrn.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-bRFMzhN-.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DWG9SB1E.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-C0XLlbo-.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-YZMg0vVb.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Jk5rOai9.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BqA0Iicc.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BZZuQBaV.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-qL2qBbXj.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Ah-bOpdK.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B9Cu-Tcj.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-65VFOjaP.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Y6avVSPj.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BRKXB-cB.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-I-3vDsod.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Ds6lL2OG.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B_ZMxoWK.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DwyfJgPk.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BchPiuVv.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Do9v7qfp.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CBO-LH04.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Bp1d9sMM.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BnYK6bCe.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-D-y61DAf.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html--omLMjfR.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Cr_MS4d7.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-vGYU_v6v.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B4BpzLXU.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B_nQF6pk.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DgK0P5kE.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-9cqk_b94.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Ftri_3bq.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-GuYWgSmr.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/filterQueryParam.html-DHuKWvja.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/filterQueryParamCode.html-BHYNEJAc.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/filterQueryParamExample.html-DOzY104s.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/jmespathFilter.html-D8C2M25U.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/whereQueryParam.html-DEIOAew5.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/whereQueryParamCode.html-BjfbCrhD.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/whereQueryParamExample.html-DpRsxLsk.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/404.html-CpAFjOLY.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index-DjpUunl4.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/mermaid.esm.min-aQNoBXQ7.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/setupDevtools-7MC2TMWH-CpnZtpW_.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><!--[--><a class="route-link" href="/NotifyBC/"><img class="vp-site-logo" src="/NotifyBC/img/logo.svg" alt="NotifyBC"></a><!----><!--]--></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/NotifyBC/docs/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/help/" aria-label="Help"><!---->Help<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/bcgov/notifybc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/NotifyBC/docs/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/help/" aria-label="Help"><!---->Help<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/bcgov/notifybc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Getting Started <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item" href="/NotifyBC/docs/" aria-label="Welcome"><!---->Welcome<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/NotifyBC/docs/overview/" aria-label="Overview"><!---->Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/quickstart/" aria-label="Quick Start"><!---->Quick Start<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/installation/" aria-label="Installation"><!---->Installation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/web-console/" aria-label="Web Console"><!---->Web Console<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/what&#39;s-new/" aria-label="What&#39;s New"><!---->What&#39;s New<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Configuration <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-overview/" aria-label="Configuration Overview"><!---->Configuration Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-database/" aria-label="Database"><!---->Database<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-adminIpList/" aria-label="Admin IP List"><!---->Admin IP List<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-reverseProxyIpLists/" aria-label="Reverse Proxy IP Lists"><!---->Reverse Proxy IP Lists<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-httpHost/" aria-label="HTTP Host"><!---->HTTP Host<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-internalHttpHost/" aria-label="Internal HTTP Host"><!---->Internal HTTP Host<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-email/" aria-label="Email"><!---->Email<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-sms/" aria-label="SMS"><!---->SMS<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-subscription/" aria-label="Subscription"><!---->Subscription<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-notification/" aria-label="Notification"><!---->Notification<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-nodeRoles/" aria-label="Node Roles"><!---->Node Roles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-cronJobs/" aria-label="Cron Jobs"><!---->Cron Jobs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-rsaKeys/" aria-label="RSA Keys"><!---->RSA Keys<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-workerProcessCount/" aria-label="Worker Process Count"><!---->Worker Process Count<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-middleware/" aria-label="Middleware"><!---->Middleware<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-oidc/" aria-label="OIDC"><!---->OIDC<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-certificates/" aria-label="TLS Certificates"><!---->TLS Certificates<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-queue/" aria-label="Queue"><!---->Queue<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-logging/" aria-label="Logging"><!---->Logging<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">API <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-overview/" aria-label="API Overview"><!---->API Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-subscription/" aria-label="Subscription"><!---->Subscription<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-notification/" aria-label="Notification"><!---->Notification<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-config/" aria-label="Configuration"><!---->Configuration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-administrator/" aria-label="Administrator"><!---->Administrator<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-bounce/" aria-label="Bounce"><!---->Bounce<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Miscellaneous <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/health-check/" aria-label="Health Check"><!---->Health Check<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/disaster-recovery/" aria-label="Disaster Recovery"><!---->Disaster Recovery<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/memory-dump/" aria-label="Memory Dump"><!---->Memory Dump<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/benchmarks/" aria-label="Benchmarks"><!---->Benchmarks<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/bulk-import/" aria-label="Bulk Import"><!---->Bulk Import<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/developer-notes/" aria-label="Developer Notes"><!---->Developer Notes<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/upgrade/" aria-label="Upgrade Guide"><!---->Upgrade Guide<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Meta <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/conduct/" aria-label="Code of Conduct"><!---->Code of Conduct<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/acknowledgments/" aria-label="Acknowledgments"><!---->Acknowledgments<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h1><p><em>NotifyBC</em> is a general purpose API Server to manage subscriptions and dispatch notifications. It aims to implement some common backend processes of a notification service without imposing any constraints on the UI frontend, nor impeding other server components&#39; functionality. This is achieved by interacting with user browser and other server components through RESTful API and other standard protocols in a loosely coupled way.</p><h2 id="features" tabindex="-1"><a class="header-anchor" href="#features"><span>Features</span></a></h2><p><em>NotifyBC</em> facilitates both anonymous and authentication-enabled secure webapps implementing notification feature. A <em>NotifyBC</em> server instance supports multiple notification services. A service is a topic of interest that user wants to receive updates. It is used as the partition of notification messages and user subscriptions. A user may subscribe to a service in multiple push delivery channels allowed. A user may subscribe to multiple services. In-app pull notification doesn&#39;t require subscription as it&#39;s not intrusive to user.</p><h3 id="notification" tabindex="-1"><a class="header-anchor" href="#notification"><span>notification</span></a></h3><ul><li>both in-app pull notifications (a.k.a. messages or alerts) and push notifications</li><li>multiple push notifications delivery channels <ul><li>email</li><li>sms</li></ul></li><li>unicast and broadcast message types</li><li>future-dated notifications</li><li>for in-app pull notifications <ul><li>support read and deleted message states</li><li>message expiration</li><li>deleted messages are not deleted immediately for auditing and recovery purposes</li></ul></li><li>for broadcast push notifications <ul><li>allow both sync and async <em>POST</em> API calls. For async API call, an optional callback url is supported</li><li>can be auto-generated from RSS feeds</li><li>allow user to specify filter rules evaluated against data contained in the notification</li><li>allow sender to specify filter rules evaluated against data contained in the subscription</li><li>allow application developer to create custom filter functions used by the filter rules mentioned above</li></ul></li></ul><h3 id="subscription-and-un-subscription" tabindex="-1"><a class="header-anchor" href="#subscription-and-un-subscription"><span>subscription and un-subscription</span></a></h3><ul><li>verify the ownership of push notification subscription channel: <ul><li>generates confirmation code based on a regex input</li><li>send confirmation request to unconfirmed subscription channel</li><li>verify confirmation code</li></ul></li><li>generate random un-subscription code</li><li>send acknowledgement message after un-subscription for anonymous subscribers</li><li>bulk unsubscription</li><li>list-unsubscribe by email</li><li>track bounces and unsubscribe the recipient from all subscriptions when hard bounce count exceeds threshold</li><li>sms user can unsubscribe by replying a shortcode keyword with Swift sms provider</li></ul><h3 id="mail-merge" tabindex="-1"><a class="header-anchor" href="#mail-merge"><span>mail merge</span></a></h3><p>Strings in notification or subscription message that are enclosed between curly braces <em>{</em> <em>}</em> are called tokens, also known as placeholders. Tokens are replaced based on the context of notification or subscription when dispatching the message. To avoid treating a string between curly braces as a token, escape the curly braces with backslash <em>\</em>. For example <em>\{i_am_not_a_token\}</em> is not a token. It will be rendered as <em>{i_am_not_a_token}</em>.</p><p>Tokens whose names are predetermined by <em>NotifyBC</em> are called static tokens; otherwise they are called dynamic tokens.</p><h4 id="static-tokens" tabindex="-1"><a class="header-anchor" href="#static-tokens"><span>static tokens</span></a></h4><p><em>NotifyBC</em> recognizes following case-insensitive static tokens. Most of the names are self-explanatory.</p><ul><li>{subscription_confirmation_url}</li><li>{subscription_confirmation_code}</li><li>{service_name}</li><li>{http_host} - http host in the form <i>http(s): //&lt;host_name&gt;:&lt;port&gt;</i>. The value is obtained from the http request that triggers the message</li><li>{rest_api_root} - REST API URL path prefix</li><li>{subscription_id}</li><li>anonymous unsubscription related tokens <ul><li>{unsubscription_url}</li><li>{unsubscription_all_url} - url to unsubscribe all services the user has subscribed on this <i>NotifyBC</i> instance</li><li>{unsubscription_code}</li><li>{unsubscription_reversion_url}</li><li>{unsubscription_service_names} - includes {service_name} and additional services user has unsubscribed, prefixed with conditionally pluralized word <i>service</i>.</li></ul></li></ul><h4 id="dynamic-tokens" tabindex="-1"><a class="header-anchor" href="#dynamic-tokens"><span>dynamic tokens</span></a></h4><p>Dynamic tokens are replaced with correspondingly named sub-field of <em>data</em> field in the notification or subscription if exist. Qualify token name with <em>notification::</em> or <em>subscription::</em> to indicate the source of substitution. If token name is not qualified, then both notification and subscription are checked, with notification taking precedence. Nested and indexed sub-fields are supported.</p><p>Examples</p><ul><li><em>{notification::description}</em> is replaced with field <em>data.description</em> of the notification if exist</li><li><em>{subscription::gender}</em> is replaced with field <em>data.gender</em> of the subscription if exist</li><li><em>{addresses[0].city}</em> is replaced with field <em>data.addresses[0].city</em> of the notification if exist; otherwise is replaced with field <em>data.addresses[0].city</em> of the subscription if exist</li><li><em>{nonexistingDataField}</em> is unreplaced if neither notification nor subscription contains <em>data.nonexistingDataField</em></li></ul><p>As exception, in order to prevent spamming by unconfirmed subscribers, dynamic tokens in subscription <a class="route-link" href="/NotifyBC/docs/config-subscription/#confirmation-request-message">confirmation request message</a> and <a class="route-link" href="/NotifyBC/docs/config-subscription/#duplicated-subscription">duplicated subscription</a> message are not replaced with subscription data, for example <em>{subscription::...}</em> tokens are left unchanged.</p><div class="hint-container tip"><p class="hint-container-title">Notification by RSS feeds relies on dynamic token</p><p>A notification created by RSS feeds relies on dynamic token to supply the context to message template. In this case the <i>data</i> field contains the RSS item.</p></div><h2 id="architecture" tabindex="-1"><a class="header-anchor" href="#architecture"><span>Architecture</span></a></h2><h3 id="request-types" tabindex="-1"><a class="header-anchor" href="#request-types"><span>Request Types</span></a></h3><p><em>NotifyBC</em>, designed to be a microservice, doesn&#39;t use full-blown ACL to secure API calls. Instead, it classifies incoming requests into admin and user types. The key difference is while both admin and user can subscribe to notifications, only admin can post notifications.</p><p>Each type has two subtypes based on following criteria</p><ul><li><p>super-admin, if the request meets both of the following two requirements</p><ol><li><p>The request carries one of the following two attributes</p><ul><li>the source ip is in the admin ip list</li><li>has a client certificate that is signed using <em>NotifyBC</em> server certificate. See <a class="route-link" href="/NotifyBC/docs/config-certificates/#client-certificate-authentication">Client certificate authentication</a> on how to sign.</li></ul></li><li><p>The request doesn&#39;t contain any of following case insensitive HTTP headers, with the first three being SiteMinder headers</p><ul><li>sm_universalid</li><li>sm_user</li><li>smgov_userdisplayname</li><li>is_anonymous</li></ul></li></ol></li><li><p>admin, if the request is not super-admin and meets one of the following criteria</p><ul><li>has a valid access token associated with an builtin admin user created and logged in using the <em>administrator</em> api, and the request doesn&#39;t contain any HTTP headers listed above</li><li>has a valid OIDC access token containing customizable admin profile attributes</li></ul><div class="hint-container tip"><p class="hint-container-title">access token disambiguation</p><p>Here the term <em>access token</em> has been used to refer two different things</p><ol><li>the token associated with a builtin admin user</li><li>the token generated by OIDC provider.</li></ol><p>To reduce confusion, throughout the documentation the former is called <em>access token</em> and the latter is called <em>OIDC access token</em>.</p></div></li><li><p>authenticated user, if the request is neither super-admin nor admin, and meets one fo the following criteria</p><ul><li>contains any of the 3 SiteMinder headers listed above, and comes from either trusted SiteMinder proxy or admin ip list</li><li>contains a valid OIDC access token</li></ul></li><li><p>anonymous user, if the request doesn&#39;t meet any of the above criteria</p></li></ul><p>The only extra privileges that a super-admin has over admin are that super-admin can perform CRUD operations on <em>configuration</em>, <em>bounce</em> and <em>administrator</em> entities through REST API. In the remaining docs, when no further distinction is necessary, an admin request refers to both super-admin and admin request; a user request refers to both authenticated and anonymous request.</p><p>An admin request carries full authorization whereas user request has limited access. For example, a user request is not allowed to</p><ul><li>send notification</li><li>bypass the delivery channel confirmation process when subscribing to a service</li><li>retrieve push notifications through API (can only receive notification from push notification channel such as email)</li><li>retrieve in-app notifications that is not targeted to the current user</li></ul><p>The result of an API call to the same end point may differ depending on the request type. For example, the call <em>GET /notifications</em> without a filter will return all notifications to all users for an admin request, but only non-deleted, non-expired in-app notifications for authenticated user request, and forbidden for anonymous user request. Sometimes it is desirable for a request from admin ip list, which would normally be admin request, to be voluntarily downgraded to user request in order to take advantage of predefined filters such as the ones described above. This can be achieved by adding one of the HTTP headers listed above to the request. This is also why admin request is not determined by ip or token alone.</p><p>The way <em>NotifyBC</em> interacts with other components is diagrammed below. <img src="/NotifyBC/img/architecture.svg" alt="architecture diagram"></p><h3 id="authentication-strategies" tabindex="-1"><a class="header-anchor" href="#authentication-strategies"><span>Authentication Strategies</span></a></h3><p>API requests to <em>NotifyBC</em> can be either anonymous or authenticated. As alluded in <a href="#request-types">Request Types</a> above, <em>NotifyBC</em> supports following authentication strategies</p><ol><li>ip whitelisting</li><li>client certificate</li><li>access token associated with an builtin admin user</li><li>OpenID Connect (OIDC)</li><li>CA SiteMinder</li></ol><p>Authentication is performed in above order. Once a request passed an authentication strategy, the rest strategies are skipped. A request that failed all authentication strategies is anonymous.</p><p>The mapping between authentication strategy and request type is</p><table class="tg"><tbody><tr><td class="tg-0pky" rowspan="2"></td><td class="tg-c3ow" colspan="2">Admin</td><td class="tg-c3ow" colspan="2">User</td></tr><tr><td class="tg-btxf">Super-admin</td><td class="tg-btxf">admin</td><td class="tg-btxf">authenticated</td><td class="tg-btxf">anonymous</td></tr><tr><td class="tg-0pky">ip whitelisting</td><td class="tg-c3ow">✔</td><td class="tg-c3ow"></td><td class="tg-c3ow"></td><td class="tg-c3ow"></td></tr><tr><td class="tg-btxf">client certifcate</td><td class="tg-abip">✔</td><td class="tg-abip"></td><td class="tg-abip"></td><td class="tg-abip"></td></tr><tr><td class="tg-0pky">access token</td><td class="tg-c3ow"></td><td class="tg-c3ow">✔</td><td class="tg-c3ow"></td><td class="tg-c3ow"></td></tr><tr><td class="tg-btxf">OIDC</td><td class="tg-abip"></td><td class="tg-abip">✔</td><td class="tg-abip">✔</td><td class="tg-abip"></td></tr><tr><td class="tg-0pky">SiteMinder</td><td class="tg-c3ow"></td><td class="tg-c3ow"></td><td class="tg-c3ow">✔</td><td class="tg-c3ow"></td></tr></tbody></table><div class="hint-container tip"><p class="hint-container-title">Which authentication strategy to use?</p><p>Because ip whitelist doesn&#39;t expire and client certificate usually has a relatively long expiration period (say one year), they are suitable for long-running unattended server processes such as server-side code of web apps, cron jobs, IOT sensors etc. The server processes have to be trusted because once authenticated, they have full privilege to <em>NotifyBC</em>. Usually the server processes and <em>NotifyBC</em> instance are in the same administrative domain, i.e. managed by the same admin group of an organization.</p><p>By contrast, OIDC and SiteMinder use short-lived tokens or session cookies. Therefore they are only suitable for interactive user sessions.</p><p>Access token associated with an builtin admin user should be avoided whenever possible.</p><p>Here are some common scenarios and recommendations</p><ul><li><p>For server-side code of web apps</p><ul><li>use OIDC if the web app is OIDC enabled and user requests can be proxied to <em>NotifyBC</em> by web app; otherwise</li><li>use ip whitelisting if obtaining ip is feasible; otherwise</li><li>use client certificate (requires a little more config than ip whitelisting)</li></ul></li><li><p>For front-end browser-based web apps such as SPAs</p><ul><li>use OIDC</li></ul></li><li><p>For server apps that send requests spontaneously such as IOT sensors, cron jobs</p><ul><li>use ip whitelisting if obtaining ip is feasible; otherwise</li><li>client certificate</li></ul></li><li><p>If <em>NotifyBC</em> is ued by a <em>SiteMinder</em> protected web apps and <em>NotifyBC</em> is also protected by <em>SiteMinder</em></p><ul><li>use SiteMinder</li></ul></li></ul></div><h2 id="application-framework" tabindex="-1"><a class="header-anchor" href="#application-framework"><span>Application Framework</span></a></h2><p><em>NotifyBC</em> is created on <a href="https://nestjs.com/" target="_blank" rel="noopener noreferrer">NestJS</a>. Contributors to source code of <em>NotifyBC</em> should be familiar with NestJS. <a href="https://docs.nestjs.com/" target="_blank" rel="noopener noreferrer">NestJS Docs</a> serves a good complement to this documentation.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link route-link-active auto-link prev" href="/NotifyBC/docs/" aria-label="Welcome"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Welcome</span></div></a><a class="route-link auto-link next" href="/NotifyBC/docs/quickstart/" aria-label="Quick Start"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Quick Start</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/NotifyBC/assets/app-2XzYbNgn.js" defer></script>
  </body>
</html>
