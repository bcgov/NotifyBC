<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" type="image/x-icon" href="/NotifyBC/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title>Upgrade Guide | NotifyBC</title><meta name="description" content="A versatile notification API server">
    <link rel="preload" href="/NotifyBC/assets/style-BwJoByYn.css" as="style"><link rel="stylesheet" href="/NotifyBC/assets/style-BwJoByYn.css">
    <link rel="modulepreload" href="/NotifyBC/assets/app-DDGjx73m.js"><link rel="modulepreload" href="/NotifyBC/assets/index.html-nbeasecI.js">
    <link rel="prefetch" href="/NotifyBC/assets/index.html-DgLTiY88.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-b5vtOo-J.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CQA7tvg9.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BHZNQ_Hg.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-D2RSw1Yi.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BfK_-aQj.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-b1Gv7CRz.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-82KXpiP2.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-2W_ng58A.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-OPijP7LM.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BWOLQNQo.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BPDOVZyK.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CAp00HLr.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CbQx_SyT.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BM4Uv0gh.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DCJsv7Pw.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CvBbLxLe.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BCzeth45.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-hwNWvw5d.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B52w1CJ9.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DHJrmiGc.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-D_QaYlqG.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B8GHuq4d.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CRjBBVjZ.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-l1u6b_XA.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-ClEuSxkH.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Ccj2fBU1.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BDQ3ImKi.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DbyQovC7.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DE51OJI2.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DWn4dLJ8.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-BpR83jX3.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-8SYtyN0N.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B-g8Oi1R.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DejumWWo.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-V-dKlj-X.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-B9JdN93G.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-CGyScor5.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-DAtTdW5B.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-ErAwJIaB.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index.html-Brox_wqk.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/filterQueryParam.html-BNgD84Ih.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/filterQueryParamCode.html-BNbIGs2n.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/filterQueryParamExample.html-BteEECZ4.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/jmespathFilter.html-DCuAP3l-.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/whereQueryParam.html-DWSIoE5M.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/whereQueryParamCode.html-DOPzdE-h.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/whereQueryParamExample.html-Bc1zkrmv.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/404.html-2dukah51.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/index-DjpUunl4.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/mermaid.esm.min-BQD0XwPU.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/setupDevtools-7MC2TMWH-pHSc_ZfW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><!--[--><a class="route-link" href="/NotifyBC/"><img class="vp-site-logo" src="/NotifyBC/img/logo.svg" alt="NotifyBC"></a><!----><!--]--></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/NotifyBC/docs/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/help/" aria-label="Help"><!---->Help<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/bcgov/notifybc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/NotifyBC/docs/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/help/" aria-label="Help"><!---->Help<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/bcgov/notifybc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Getting Started <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item" href="/NotifyBC/docs/" aria-label="Welcome"><!---->Welcome<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/overview/" aria-label="Overview"><!---->Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/quickstart/" aria-label="Quick Start"><!---->Quick Start<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/installation/" aria-label="Installation"><!---->Installation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/web-console/" aria-label="Web Console"><!---->Web Console<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/what&#39;s-new/" aria-label="What&#39;s New"><!---->What&#39;s New<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Configuration <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-overview/" aria-label="Configuration Overview"><!---->Configuration Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-database/" aria-label="Database"><!---->Database<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-adminIpList/" aria-label="Admin IP List"><!---->Admin IP List<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-reverseProxyIpLists/" aria-label="Reverse Proxy IP Lists"><!---->Reverse Proxy IP Lists<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-httpHost/" aria-label="HTTP Host"><!---->HTTP Host<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-internalHttpHost/" aria-label="Internal HTTP Host"><!---->Internal HTTP Host<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-email/" aria-label="Email"><!---->Email<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-sms/" aria-label="SMS"><!---->SMS<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-subscription/" aria-label="Subscription"><!---->Subscription<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-notification/" aria-label="Notification"><!---->Notification<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-nodeRoles/" aria-label="Node Roles"><!---->Node Roles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-cronJobs/" aria-label="Cron Jobs"><!---->Cron Jobs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-rsaKeys/" aria-label="RSA Keys"><!---->RSA Keys<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-workerProcessCount/" aria-label="Worker Process Count"><!---->Worker Process Count<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-middleware/" aria-label="Middleware"><!---->Middleware<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-oidc/" aria-label="OIDC"><!---->OIDC<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-certificates/" aria-label="TLS Certificates"><!---->TLS Certificates<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-queue/" aria-label="Queue"><!---->Queue<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/config-logging/" aria-label="Logging"><!---->Logging<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">API <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-overview/" aria-label="API Overview"><!---->API Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-subscription/" aria-label="Subscription"><!---->Subscription<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-notification/" aria-label="Notification"><!---->Notification<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-config/" aria-label="Configuration"><!---->Configuration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-administrator/" aria-label="Administrator"><!---->Administrator<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/api-bounce/" aria-label="Bounce"><!---->Bounce<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Miscellaneous <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/health-check/" aria-label="Health Check"><!---->Health Check<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/disaster-recovery/" aria-label="Disaster Recovery"><!---->Disaster Recovery<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/memory-dump/" aria-label="Memory Dump"><!---->Memory Dump<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/benchmarks/" aria-label="Benchmarks"><!---->Benchmarks<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/bulk-import/" aria-label="Bulk Import"><!---->Bulk Import<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/developer-notes/" aria-label="Developer Notes"><!---->Developer Notes<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/NotifyBC/docs/upgrade/" aria-label="Upgrade Guide"><!---->Upgrade Guide<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Meta <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/conduct/" aria-label="Code of Conduct"><!---->Code of Conduct<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/docs/acknowledgments/" aria-label="Acknowledgments"><!---->Acknowledgments<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="upgrade-guide" tabindex="-1"><a class="header-anchor" href="#upgrade-guide"><span>Upgrade Guide</span></a></h1><p>Major version can only be upgraded incrementally from immediate previous major version, i.e. from <em>N</em> to <em>N+1</em>.</p><h2 id="v5-to-v6" tabindex="-1"><a class="header-anchor" href="#v5-to-v6"><span>v5 to v6</span></a></h2><p>v6 introduced following backward incompatible changes</p><ol><li><p>Redis is required. Redis connection is moved from <code>sms.throttle.clientOptions</code> and <code>email.throttle.clientOptions</code> to <code>queue.connection</code>. Update file <em>src/config.local.[json|js|ts]</em> from, for example,</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  sms<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    throttle<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ...</span></span>
<span class="line">      datastore<span class="token operator">:</span> <span class="token string">&#39;ioredis&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      clientOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        host<span class="token operator">:</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        port<span class="token operator">:</span> <span class="token number">6379</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  email<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    throttle<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ...</span></span>
<span class="line">      datastore<span class="token operator">:</span> <span class="token string">&#39;ioredis&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      clientOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        host<span class="token operator">:</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        port<span class="token operator">:</span> <span class="token number">6379</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>to</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts" data-title="ts"><pre><code><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  sms<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    throttle<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line">  email<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    throttle<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ...</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  queue<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    connection<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      host<span class="token operator">:</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      port<span class="token operator">:</span> <span class="token number">6379</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you deployed NotifyBC using Helm and haven&#39;t customized Redis connection in file <em>src/config.local.[json|js|ts]</em>, this change is taken care of.</p></li><li><p>config <code>minTime</code> in <code>email.throttle</code> and <code>sms.Throttle</code> is replaced with <code>max</code> and <code>duration</code>. Effectively <em>minTime=duration/max</em>. By default <code>max</code> is 4 and <code>duration</code> is 1000, equivalent to default <code>minTime</code> of 250.</p></li><li><p>Terms for <a class="route-link" href="/NotifyBC/docs/config-nodeRoles/">node roles</a> have changed. If you defined environment variable <em>NOTIFYBC_NODE_ROLE</em> with value other than <em>slave</em>, remove the environment variable; otherwise change it to <em>secondary</em>. If you deployed NotifyBC using Helm, this change is taken care of.</p></li><li><p>config <code>notification.broadcastSubRequestBatchSize</code> is deprecated. If you defined it in <em>src/config.local.js</em>, remove it.</p></li><li><p>Bitnami MongoDB Helm chart is updated from version 14.3.2 to 16.3.3, with corresponding MongoDB from 7.0.4 to 8.0.4. If you deployed <em>NotifyBC</em> using Helm, or if you are running MongoDB 7 and planning to upgrade to MongoDB 8, follow <a href="https://www.mongodb.com/docs/manual/release-notes/8.0-upgrade/" target="_blank" rel="noopener noreferrer">Upgrade 7.0 to 8.0</a>. In particular, ensure <code>setFeatureCompatibilityVersion</code> is set to <code>7.0</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">db.adminCommand( { getParameter: 1, featureCompatibilityVersion: 1 } )</span>
<span class="line">db.adminCommand( { setFeatureCompatibilityVersion: &quot;7.0&quot; } )</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Default SMTP service is changed from localhost to Ethereal. Make sure to setup <a class="route-link" href="/NotifyBC/docs/config-email/#smtp">SMTP</a> in production if haven&#39;t done so.</p></li></ol><p>After above changes are addressed, to upgrade <em>NotifyBC</em> to v6,</p><ul><li><p>if <em>NotifyBC</em> is deployed from source code, run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v6.x.x</span>
<span class="line"><span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Replace</p><ul><li><em>v6.x.x</em> with a v6 release, preferably latest, found in GitHub such as <em>v6.0.3</em>.</li></ul></li><li><p>if <em>NotifyBC</em> is deployed to Kubernetes using Helm,</p><ol><li>backup MongoDB database</li><li>run<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v6.x.x</span>
<span class="line">helm upgrade <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span> <span class="token parameter variable">-f</span> helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml <span class="token parameter variable">-f</span> helm/values.local.yaml helm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>Replace <ul><li><em>v6.x.x</em> with a v6 release, preferably latest, found in GitHub such as <em>v6.0.3</em>.</li><li>&lt;release-name&gt; with installed helm release name</li><li>&lt;platform&gt; with <em>openshift</em> or <em>aks</em> depending on your platform</li></ul></li></ol></li></ul><h2 id="v4-to-v5" tabindex="-1"><a class="header-anchor" href="#v4-to-v5"><span>v4 to v5</span></a></h2><p>v5 introduced following backward incompatible changes</p><ol><li><p>Replica set is required for MongoDB. If you deployed NotifyBC using Helm, replica set is already enabled by default.</p></li><li><p>If you use default in-memory database, data in <em>server/database/data.json</em> will not be migrated automatically. Manually migrate if necessary.</p></li><li><p>Update file <em>src/datasources/db.datasource.local.[json|js|ts]</em></p><ol><li>rename <em>url</em> property to <em>uri</em></li><li>for other properties, instead of following <a href="https://loopback.io/doc/en/lb4/MongoDB-connector.html#creating-a-mongodb-data-source" target="_blank" rel="noopener noreferrer">LoopBack MongoDB data source</a>, follow <a href="https://mongoosejs.com/docs/connections.html#options" target="_blank" rel="noopener noreferrer">Mongoose connection options</a>. In particular, <em>host</em>, <em>port</em> and <em>database</em> properties are no longer supported. Use <em>uri</em> instead.</li></ol><p>For example, change</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;db&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;connector&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mongodb&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mongodb://127.0.0.1:27017/notifyBC&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>to</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;uri&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mongodb://127.0.0.1:27017/notifyBC&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you deployed NotifyBC using Helm, this is taken care of.</p></li><li><p>API querying operators have changed. Replace following <a href="https://loopback.io/doc/en/lb4/Where-filter.html#operators" target="_blank" rel="noopener noreferrer">Loopback operators</a> with corresponding <a href="https://www.mongodb.com/docs/manual/reference/operator/query/" target="_blank" rel="noopener noreferrer">MongoDB operators</a> at your client-side API call.</p><table><thead><tr><th>Loopback operators</th><th>MongoDB operators</th></tr></thead><tbody><tr><td>eq</td><td>$eq</td></tr><tr><td>and</td><td>$and</td></tr><tr><td>or</td><td>$or</td></tr><tr><td>gt, gte</td><td>$gt, $gte</td></tr><tr><td>lt, lte</td><td>$lt, $lte</td></tr><tr><td>between</td><td>(no equivalent, replace with $gt, $and and $lt)</td></tr><tr><td>inq, nin</td><td>$in, $nin</td></tr><tr><td>near</td><td>$near</td></tr><tr><td>neq</td><td>$ne</td></tr><tr><td>like, nlike</td><td>(replace with $regexp)</td></tr><tr><td>like, nlike, options: i</td><td>(replace with $regexp)</td></tr><tr><td>regexp</td><td>$regex</td></tr></tbody></table></li><li><p>API <em>order</em> filter syntax has changed. Replace syntax from <a href="https://loopback.io/doc/en/lb4/Order-filter.html" target="_blank" rel="noopener noreferrer">Loopback</a> to <a href="https://mongoosejs.com/docs/api/query.html#Query.prototype.sort()" target="_blank" rel="noopener noreferrer">Mongoose</a> at client-side API call. For example, if your client-side code generates following API call</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GET http://localhost:3000/api/configurations?filter={&quot;order&quot;:[&quot;serviceName asc&quot;]}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>change to either</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GET http://localhost:3000/api/configurations?filter={&quot;order&quot;:[[&quot;serviceName&quot;,&quot;asc&quot;]]}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>or</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GET http://localhost:3000/api/configurations?filter={&quot;order&quot;:&quot;serviceName&quot;}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>In MongoDB administrator collection, email has changed from case-sensitively unique to case-insensitively unique. Make sure administrator emails differ not just by case.</p></li><li><p>When a subscription is created by anonymous user, the <em>data</em> field is preserved. In earlier versions this field is deleted.</p></li><li><p>Dynamic tokens in subscription confirmation request message and duplicated subscription message are not replaced with subscription data, for example {subscription::...} tokens are left unchanged. Update the template of the two messages if dynamic tokens in them depends on subscription data.</p></li><li><p><a class="route-link" href="/NotifyBC/docs/config-email/#inbound-smtp-server">Inbound SMTP Server</a> no longer accepts command line arguments or environment variables as inputs. All inputs have to be defined in config files shown in the link.</p></li><li><p>If you deployed <em>NotifyBC</em> using Helm, change MongoDB password format in your local values yaml file from</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># in file helm/values.local.yaml</span></span>
<span class="line"><span class="token key atrule">mongodb</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">auth</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">rootPassword</span><span class="token punctuation">:</span> &lt;secret<span class="token punctuation">&gt;</span></span>
<span class="line">    <span class="token key atrule">replicaSetKey</span><span class="token punctuation">:</span> &lt;secret<span class="token punctuation">&gt;</span></span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span> &lt;secret<span class="token punctuation">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>to</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># in file helm/values.local.yaml</span></span>
<span class="line"><span class="token key atrule">mongodb</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">auth</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">rootPassword</span><span class="token punctuation">:</span> &lt;secret<span class="token punctuation">&gt;</span></span>
<span class="line">    <span class="token key atrule">replicaSetKey</span><span class="token punctuation">:</span> &lt;secret<span class="token punctuation">&gt;</span></span>
<span class="line">    <span class="token key atrule">passwords</span><span class="token punctuation">:</span></span>
<span class="line">      <span class="token punctuation">-</span> &lt;secret<span class="token punctuation">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>After above changes are addressed, to upgrade <em>NotifyBC</em> to v5,</p><ul><li><p>if <em>NotifyBC</em> is deployed from source code, run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v5.x.x</span>
<span class="line"><span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Replace</p><ul><li><em>v5.x.x</em> with a v6 release, preferably latest, found in GitHub such as <em>v5.0.0</em>.</li></ul></li><li><p>if <em>NotifyBC</em> is deployed to Kubernetes using Helm,</p><ol><li>backup MongoDB database</li><li>run<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">helm uninstall <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>Replace &lt;release-name&gt; with installed helm release name</li><li>delete PVCs used by MongoDB stateful set</li><li>run<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v5.x.x</span>
<span class="line">helm <span class="token function">install</span> <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span> <span class="token parameter variable">-f</span> helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml <span class="token parameter variable">-f</span> helm/values.local.yaml helm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>Replace <ul><li><em>v5.x.x</em> with a v5 release, preferably latest, found in GitHub such as <em>v5.0.0</em>.</li><li>&lt;release-name&gt; with installed helm release name</li><li>&lt;platform&gt; with <em>openshift</em> or <em>aks</em> depending on your platform</li></ul></li><li>restore MongoDB database</li></ol></li></ul><h2 id="v3-to-v4" tabindex="-1"><a class="header-anchor" href="#v3-to-v4"><span>v3 to v4</span></a></h2><p>v4 introduced following backward incompatible changes that need to be addressed in this order</p><ol><li><p>The precedence of config, middleware and datasource files has been changed. Local file takes higher precedence than environment specific file. For example, for config file, the new precedence in ascending order is</p><ol><li>default file <em>src/config.ts</em></li><li>environment specific file <em>src/config.&lt;env&gt;.js</em>, where &lt;env&gt; is determined by environment variable <em>NODE_ENV</em></li><li>local file <em>src/config.local.js</em></li></ol><p>To upgrade, if you have environment specific file, merge its content into the local file, then delete it.</p></li><li><p>Config <em>smtp</em> is changed to <em>email.smtp</em>. See <a class="route-link" href="/NotifyBC/docs/config-email/#smtp">SMTP</a> for example.</p></li><li><p>Config <em>inboundSmtpServer</em> is changed to <em>email.inboundSmtpServer</em>. See <a class="route-link" href="/NotifyBC/docs/config-email/#inbound-smtp-server">Inbound SMTP Server</a> for example.</p></li><li><p>Config <em>email.inboundSmtpServer.bounce</em> is changed to <em>email.bounce</em>. See <a class="route-link" href="/NotifyBC/docs/config-email/#bounce">Bounce</a> for example.</p></li><li><p>Config <em>notification.handleBounce</em> is changed to <em>email.bounce.enabled</em>.</p></li><li><p>Config <em>notification.handleListUnsubscribeByEmail</em> is changed to <em>email.listUnsubscribeByEmail.enabled</em>. See <a class="route-link" href="/NotifyBC/docs/config-email/#list-unsubscribe-by-email">List-unsubscribe by Email</a> for example.</p></li><li><p>Config <em>smsServiceProvider</em> is changed to <em>sms.provider</em>. See <a class="route-link" href="/NotifyBC/docs/config-sms/#provider">Provider</a> for example.</p></li><li><p>SMS service provider specific settings defined in config <em>sms</em> are changed to <em>sms.providerSettings</em>. See <a class="route-link" href="/NotifyBC/docs/config-sms/#provider-settings">Provider Settings</a> for example. The config object <em>sms</em> now encapsulates all SMS configs - <em>provider</em>, <em>providerSettings</em> and <em>throttle</em>.</p></li><li><p>Legacy config <em>subscription.unsubscriptionEmailDomain</em> is removed. If you have it defined in your file <em>src/config.local.js</em>, replace with <em>email.inboundSmtpServer.domain</em>.</p></li><li><p>Helm chart added Redis that requires authentication by default. Create a new password in <em>helm/values.local.yaml</em> to facilitate upgrading</p></li></ol><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre><code><span class="line"><span class="token comment"># in file helm/values.local.yaml</span></span>
<span class="line"><span class="token key atrule">redis</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token key atrule">auth</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">&#39;&lt;secret&gt;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>After above changes are addressed, upgrading to v4 is as simple as</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v4.x.x</span>
<span class="line"><span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>or, if <em>NotifyBC</em> is deployed to Kubernetes using Helm.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v4.x.x</span>
<span class="line">helm upgrade <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span> <span class="token parameter variable">-f</span> helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml <span class="token parameter variable">-f</span> helm/values.local.yaml helm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Replace <em>v4.x.x</em> with a v4 release, preferably latest, found in GitHub such as <em>v4.0.0</em>.</p><h2 id="v2-to-v3" tabindex="-1"><a class="header-anchor" href="#v2-to-v3"><span>v2 to v3</span></a></h2><p>v3 introduced following backward incompatible changes</p><ol><li>Changed output-only fields <em>failedDispatches</em> and <em>successDispatches</em> to <em>dispatch.failed</em> and <em>dispatch.successful</em> respectively in <em>Notification</em> api. If your client app depends on the fields, change accordingly.</li><li>Changed config <em>notification.logSuccessfulBroadcastDispatches</em> to <em>notification.guaranteedBroadcastPushDispatchProcessing</em> and reversed default value from <em>false</em> to <em>true</em>. If you don&#39;t want <em>NotifyBC</em> guarantees processing all subscriptions to a broadcast push notification in a node failure resilient way, perhaps for performance reason, set the value to <em>false</em> in file <em>src/config.local.js</em>.</li></ol><p>After above changes are addressed, upgrading to v3 is as simple as</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v3.x.x</span>
<span class="line"><span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>or, if <em>NotifyBC</em> is deployed to Kubernetes using Helm.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> pull</span>
<span class="line"><span class="token function">git</span> checkout tags/v3.x.x</span>
<span class="line">helm upgrade <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span> <span class="token parameter variable">-f</span> helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml <span class="token parameter variable">-f</span> helm/values.local.yaml helm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Replace <em>v3.x.x</em> with a v3 release, preferably latest, found in GitHub such as <em>v3.1.2</em>.</p><h2 id="openshift-template-to-helm" tabindex="-1"><a class="header-anchor" href="#openshift-template-to-helm"><span>OpenShift template to Helm</span></a></h2><p>Upgrading <em>NotifyBC</em> on OpenShift created from OpenShift template to Helm involves 2 steps</p><ol><li><a href="#customize-and-install-helm-chart">Customize and Install Helm chart</a></li><li><a href="#migrate-mongodb-data">Migrate MongoDB data</a></li></ol><h3 id="customize-and-install-helm-chart" tabindex="-1"><a class="header-anchor" href="#customize-and-install-helm-chart"><span>Customize and install Helm chart</span></a></h3><p>Follow <a class="route-link" href="/NotifyBC/docs/installation/#customizations">customizations</a> to create file <em>helm/values.local.yaml</em> containing customized configs such as</p><ul><li><em>notify-bc</em> configMap</li><li>web route host name and certificates</li></ul><p>Then run <code>helm install</code> with documented arguments to install a release.</p><h3 id="migrate-mongodb-data" tabindex="-1"><a class="header-anchor" href="#migrate-mongodb-data"><span>Migrate MongoDB data</span></a></h3><ol><li><p>backup data from source</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>mongodb-pod<span class="token operator">&gt;</span> -- <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&#39;mongodump -u &quot;$MONGODB_USER&quot; \</span>
<span class="line">-p &quot;$MONGODB_PASSWORD&quot; -d $MONGODB_DATABASE --gzip --archive&#39;</span> <span class="token operator">&gt;</span> notify-bc.gz</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>replace &lt;mongodb-pod&gt; with the mongodb pod name.</p></li><li><p>restore backup to target</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">cat</span> notify-bc.gz <span class="token operator">|</span> oc <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>mongodb-pod-<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> -- <span class="token punctuation">\</span></span>
<span class="line"><span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&#39;mongorestore -u &quot;$MONGODB_USERNAME&quot; -p&quot;$MONGODB_PASSWORD&quot; \</span>
<span class="line">--uri=&quot;mongodb://$K8S_SERVICE_NAME&quot; --db $MONGODB_DATABASE --gzip --drop --archive&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>replace &lt;mongodb-pod-0&gt; with the first pod name in the mongodb stateful set.</p></li></ol><p>If both source and target are in the same OpenShift cluster, the two operations can be combined into one</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>mongodb-pod<span class="token operator">&gt;</span> -- <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token string">&#39;mongodump -u &quot;$MONGODB_USER&quot; \</span>
<span class="line">-p &quot;$MONGODB_PASSWORD&quot; -d $MONGODB_DATABASE --gzip --archive&#39;</span> <span class="token operator">|</span> <span class="token punctuation">\</span></span>
<span class="line">oc <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> <span class="token operator">&lt;</span>mongodb-pod-<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> -- <span class="token function">bash</span> <span class="token parameter variable">-c</span> <span class="token punctuation">\</span></span>
<span class="line"><span class="token string">&#39;mongorestore -u &quot;$MONGODB_USERNAME&quot; -p&quot;$MONGODB_PASSWORD&quot; \</span>
<span class="line">--uri=&quot;mongodb://$K8S_SERVICE_NAME&quot; --db $MONGODB_DATABASE --gzip --drop --archive&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="v1-to-v2" tabindex="-1"><a class="header-anchor" href="#v1-to-v2"><span>v1 to v2</span></a></h2><p>Upgrading <em>NotifyBC</em> from v1 to v2 involves two steps</p><ol><li><a href="#update-your-client-code">Update your client code</a> if needed</li><li><a href="#upgrade-notifybc-server">Upgrade <em>NotifyBC</em> server</a></li></ol><h3 id="update-your-client-code" tabindex="-1"><a class="header-anchor" href="#update-your-client-code"><span>Update your client code</span></a></h3><p><em>NotifyBC</em> v2 introduced backward incompatible API changes documented in the rest of this section. If your client code will be impacted by the changes, update your code to address the incompatibility first.</p><h4 id="query-parameter-array-syntax" tabindex="-1"><a class="header-anchor" href="#query-parameter-array-syntax"><span>Query parameter array syntax</span></a></h4><p>In v1 array can be specified in query parameter using two formats</p><ol><li>by enclosing array elements in square brackets such as <code>&amp;additionalServices=[&quot;s1&quot;,&quot;s2]</code> in one query parameter</li><li>by repeating the query parameters, for example <code>&amp;additionalServices=s1&amp;additionalServices=s2</code></li></ol><p>In v2 only the latter format is supported.</p><h4 id="date-time-fields" tabindex="-1"><a class="header-anchor" href="#date-time-fields"><span>Date-Time fields</span></a></h4><p>In v1 date-time fields can be specified in date-only string such as 2020-01-01. In v2 the field must be specified in ISO 8601 extended format such as 2020-01-01T00:00:00Z.</p><h4 id="return-status-codes" tabindex="-1"><a class="header-anchor" href="#return-status-codes"><span>Return status codes</span></a></h4><p>HTTP response code of success calls to following APIs are changed from 200 to 204</p><ul><li>most PATCH by id requests except for <a class="route-link" href="/NotifyBC/docs/api-subscription/#update-a-subscription">Update a Subscription </a></li><li>most PUT by id requests except for <a class="route-link" href="/NotifyBC/docs/api-subscription/#replace-a-subscription">Replace a Subscription</a></li><li>most DELETE by id requests except for <a class="route-link" href="/NotifyBC/docs/api-subscription/#delete-a-subscription-unsubscribing">Delete a Subscription (unsubscribing)</a></li></ul><h4 id="administrator-api" tabindex="-1"><a class="header-anchor" href="#administrator-api"><span>Administrator API</span></a></h4><ul><li>Password is saved to <em>Administrator</em> in v1 and <em>UserCredential</em> in v2. Password is not migrated. New password has to be created by following <a class="route-link" href="/NotifyBC/docs/api-administrator/#create-update-an-administrator-s-usercredential">Create/Update an Administrator&#39;s UserCredential </a>.</li><li><a class="route-link" href="/NotifyBC/docs/api-administrator/#sign-up">Complexity rules</a> have been applied to passwords.</li><li><a class="route-link" href="/NotifyBC/docs/api-administrator/#login">login</a> API is open to non-admin</li></ul><h3 id="upgrade-notifybc-server" tabindex="-1"><a class="header-anchor" href="#upgrade-notifybc-server"><span>Upgrade <em>NotifyBC</em> server</span></a></h3><p>The procedure to upgrade from v1 to v2 depends on how v1 was installed.</p><h4 id="source-code-installation" tabindex="-1"><a class="header-anchor" href="#source-code-installation"><span>Source-code Installation</span></a></h4><ol><li>Stop <em>NotifyBC</em></li><li>Backup app root and database!</li><li>Make sure current branch is tracking correct remote branch<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> remote set-url origin https://github.com/bcgov/NotifyBC.git</span>
<span class="line"><span class="token function">git</span> branch <span class="token parameter variable">-u</span> origin/main</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>Make a note of any extra packages added to <em>package.json</em></li><li>Run <code>git pull &amp;&amp; git checkout tags/v2.x.x</code> from app root, replace <em>v2.x.x</em> with a v2 release, preferably latest, found in GitHub such as <em>v2.9.0</em>.</li><li>Make sure <em>version</em> property in <em>package.json</em> is <em>2.x.x</em></li><li>Add back extra packages noted in step 4</li><li>Move <em>server/config.(local|dev|production).(js|json)</em> to <em>src/</em> if exists</li><li>Move <em>server/datasources.(local|dev|production).(js|json)</em> to <em>src/datasources/db.datasource.(local|dev|production).(js|json)</em> if exists. Notice the file name has changed.</li><li>Move <em>server/middleware.*.(js|json)</em> to <em>src/</em> if exists. Reorganize top level properties to <em>all</em> or <em>apiOnly</em>, where <em>all</em> applies to all requests including web console and <em>apiOnly</em> applies to API requests only. For example, given</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">initial</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">compression</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&#39;routes:before&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">morgan</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>if <em>compression</em> middleware will be applied to all requests and <em>morgan</em> will be applied to API requests only, then change the file to</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">all</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">compression</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">apiOnly</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">morgan</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="11"><li>Run</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">npm</span> i <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="11"><li>Start server by running <code>npm run start</code> or Windows Service</li></ol><h4 id="openshift-installation" tabindex="-1"><a class="header-anchor" href="#openshift-installation"><span>OpenShift Installation</span></a></h4><ol><li><p>Run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> clone https://github.com/bcgov/NotifyBC.git</span>
<span class="line"><span class="token builtin class-name">cd</span> NotifyBC</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc delete bc/notify-bc</span>
<span class="line">oc process <span class="token parameter variable">-f</span> .openshift-templates/notify-bc-build.yml <span class="token operator">|</span> oc create -f-</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ignore <em>AlreadyExists</em> errors</p></li><li><p>Follow OpenShift <a class="route-link" href="/NotifyBC/docs/installation/#build">Build</a></p></li><li><p>For each environment,</p><ol><li><p>run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc project <span class="token operator">&lt;</span>yourprojectname-<span class="token operator">&lt;</span>env<span class="token operator">&gt;&gt;</span></span>
<span class="line">oc delete dc/notify-bc-app dc/notify-bc-cron</span>
<span class="line">oc process <span class="token parameter variable">-f</span> .openshift-templates/notify-bc.yml <span class="token operator">|</span> oc create -f-</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ignore <em>AlreadyExists</em> errors</p></li><li><p>copy value of environment variable <em>MONGODB_USER</em> from <em>mongodb</em> deployment config to the same environment variable of deployment config <em>notify-bc-app</em> and <em>notify-bc-cron</em>, replacing existing value</p></li><li><p>remove <em>middleware.local.json</em> from configMap <em>notify-bc</em></p></li><li><p>add <em>middleware.local.js</em> to configMap <em>notify-bc</em> with following content</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">apiOnly</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">morgan</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Follow OpenShift <a class="route-link" href="/NotifyBC/docs/installation/#deploy">Deploy</a> or <a class="route-link" href="/NotifyBC/docs/installation/#change-propagation">Change Propagation</a> to tag image</p></li></ol></li></ol></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/NotifyBC/docs/developer-notes/" aria-label="Developer Notes"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Developer Notes</span></div></a><a class="route-link auto-link next" href="/NotifyBC/docs/conduct/" aria-label="Code of Conduct"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Code of Conduct</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/NotifyBC/assets/app-DDGjx73m.js" defer></script>
  </body>
</html>
