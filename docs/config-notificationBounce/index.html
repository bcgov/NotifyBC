<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Notification Bounce | NotifyBC</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" type="image/x-icon" href="/NotifyBC/favicon.ico">
    <meta name="description" content="A versatile notification API server">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/NotifyBC/assets/css/0.styles.53d88404.css" as="style"><link rel="preload" href="/NotifyBC/assets/js/app.47c10ac5.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/4.a700b1f7.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/5.cf402d1d.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/27.54e89f3a.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/js/1.bd48a1db.js"><link rel="prefetch" href="/NotifyBC/assets/js/10.2d1de9f4.js"><link rel="prefetch" href="/NotifyBC/assets/js/11.775fb5a4.js"><link rel="prefetch" href="/NotifyBC/assets/js/12.f3c91a2f.js"><link rel="prefetch" href="/NotifyBC/assets/js/13.fb0567ea.js"><link rel="prefetch" href="/NotifyBC/assets/js/14.eeb2938d.js"><link rel="prefetch" href="/NotifyBC/assets/js/15.be5e99a8.js"><link rel="prefetch" href="/NotifyBC/assets/js/16.097062c6.js"><link rel="prefetch" href="/NotifyBC/assets/js/17.db15a07a.js"><link rel="prefetch" href="/NotifyBC/assets/js/18.4d240753.js"><link rel="prefetch" href="/NotifyBC/assets/js/19.c01358de.js"><link rel="prefetch" href="/NotifyBC/assets/js/20.f925cc4f.js"><link rel="prefetch" href="/NotifyBC/assets/js/21.2e6cabab.js"><link rel="prefetch" href="/NotifyBC/assets/js/22.30511bc8.js"><link rel="prefetch" href="/NotifyBC/assets/js/23.e025d8ec.js"><link rel="prefetch" href="/NotifyBC/assets/js/24.7fd032cb.js"><link rel="prefetch" href="/NotifyBC/assets/js/25.7ae75f5b.js"><link rel="prefetch" href="/NotifyBC/assets/js/26.7c82cbf7.js"><link rel="prefetch" href="/NotifyBC/assets/js/28.80588ecc.js"><link rel="prefetch" href="/NotifyBC/assets/js/29.e76ec05f.js"><link rel="prefetch" href="/NotifyBC/assets/js/30.13b819f1.js"><link rel="prefetch" href="/NotifyBC/assets/js/31.d32e2076.js"><link rel="prefetch" href="/NotifyBC/assets/js/32.723fdbe8.js"><link rel="prefetch" href="/NotifyBC/assets/js/33.65f34406.js"><link rel="prefetch" href="/NotifyBC/assets/js/34.904810fc.js"><link rel="prefetch" href="/NotifyBC/assets/js/35.6c65bb07.js"><link rel="prefetch" href="/NotifyBC/assets/js/36.aa91568a.js"><link rel="prefetch" href="/NotifyBC/assets/js/37.9b905223.js"><link rel="prefetch" href="/NotifyBC/assets/js/38.3452ca8c.js"><link rel="prefetch" href="/NotifyBC/assets/js/39.3b69143a.js"><link rel="prefetch" href="/NotifyBC/assets/js/40.2c0385d2.js"><link rel="prefetch" href="/NotifyBC/assets/js/41.db4d21e2.js"><link rel="prefetch" href="/NotifyBC/assets/js/42.e8006138.js"><link rel="prefetch" href="/NotifyBC/assets/js/43.91758575.js"><link rel="prefetch" href="/NotifyBC/assets/js/44.253bc5c7.js"><link rel="prefetch" href="/NotifyBC/assets/js/45.98a92ee3.js"><link rel="prefetch" href="/NotifyBC/assets/js/46.45c1a4af.js"><link rel="prefetch" href="/NotifyBC/assets/js/47.34a7a0b7.js"><link rel="prefetch" href="/NotifyBC/assets/js/6.a1f7914e.js"><link rel="prefetch" href="/NotifyBC/assets/js/7.5d4b76e5.js"><link rel="prefetch" href="/NotifyBC/assets/js/8.5c6afc23.js"><link rel="prefetch" href="/NotifyBC/assets/js/9.d6c0ab18.js"><link rel="prefetch" href="/NotifyBC/assets/js/vendors~docsearch.22099875.js">
    <link rel="stylesheet" href="/NotifyBC/assets/css/0.styles.53d88404.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/NotifyBC/" class="home-link router-link-active"><img src="/NotifyBC/img/logo.svg" alt="NotifyBC" class="logo"></a> <!----> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/NotifyBC/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/bcgov/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/NotifyBC/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/bcgov/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/" aria-current="page" class="sidebar-link">Welcome</a></li><li><a href="/NotifyBC/docs/overview/" class="sidebar-link">Overview</a></li><li><a href="/NotifyBC/docs/quickstart/" class="sidebar-link">Quick Start</a></li><li><a href="/NotifyBC/docs/installation/" class="sidebar-link">Installation</a></li><li><a href="/NotifyBC/docs/usage/" class="sidebar-link">Basic Usage</a></li><li><a href="/NotifyBC/docs/what's-new/" class="sidebar-link">What's New</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Configuration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/config-overview/" class="sidebar-link">Configuration Overview</a></li><li><a href="/NotifyBC/docs/config-database/" class="sidebar-link">Database</a></li><li><a href="/NotifyBC/docs/config-adminIpList/" class="sidebar-link">Admin IP List</a></li><li><a href="/NotifyBC/docs/config-reverseProxyIpLists/" class="sidebar-link">Reverse Proxy IP Lists</a></li><li><a href="/NotifyBC/docs/config-httpHost/" class="sidebar-link">HTTP Host</a></li><li><a href="/NotifyBC/docs/config-internalHttpHost/" class="sidebar-link">Internal HTTP Host</a></li><li><a href="/NotifyBC/docs/config-smtp/" class="sidebar-link">SMTP</a></li><li><a href="/NotifyBC/docs/config-sms/" class="sidebar-link">SMS</a></li><li><a href="/NotifyBC/docs/config-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/docs/config-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/docs/config-nodeRoles/" class="sidebar-link">Node Roles</a></li><li><a href="/NotifyBC/docs/config-cronJobs/" class="sidebar-link">Cron Jobs</a></li><li><a href="/NotifyBC/docs/config-rsaKeys/" class="sidebar-link">RSA Keys</a></li><li><a href="/NotifyBC/docs/config-inboundSmtpServer/" class="sidebar-link">Inbound SMTP Server</a></li><li><a href="/NotifyBC/docs/config-listUnsubscribeByEmail/" class="sidebar-link">List-unsubscribe by Email</a></li><li><a href="/NotifyBC/docs/config-notificationBounce/" aria-current="page" class="active sidebar-link">Notification Bounce</a></li><li><a href="/NotifyBC/docs/config-workerProcessCount/" class="sidebar-link">Worker Process Count</a></li><li><a href="/NotifyBC/docs/config-middleware/" class="sidebar-link">Middleware</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/api-overview/" class="sidebar-link">API Overview</a></li><li><a href="/NotifyBC/docs/api-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/docs/api-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/docs/api-config/" class="sidebar-link">Configuration</a></li><li><a href="/NotifyBC/docs/api-administrator/" class="sidebar-link">Administrator</a></li><li><a href="/NotifyBC/docs/api-bounce/" class="sidebar-link">Bounce</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/benchmarks/" class="sidebar-link">Benchmarks</a></li><li><a href="/NotifyBC/docs/bulk-import/" class="sidebar-link">Bulk Import</a></li><li><a href="/NotifyBC/docs/developer-notes/" class="sidebar-link">Developer Notes</a></li><li><a href="/NotifyBC/docs/migration/" class="sidebar-link">Migration Guide</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Meta</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/conduct/" class="sidebar-link">Code of Conduct</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="notification-bounce"><a href="#notification-bounce" class="header-anchor">#</a> Notification Bounce</h1> <p>Bounces, or Non-Delivery Reports (NDRs), are system-generated emails informing sender of failed delivery. <em>NotifyBC</em> can be configured to receive bounces, record bounces, and automatically unsubscribe all subscriptions of a recipient if the number of recorded hard bounces against the recipient exceeds threshold. A deemed successful notification delivery deletes the bounce record.</p> <p>Although <em>NotifyBC</em> records all bounce emails, not all of them should count towards unsubscription threshold, but rather only the hard bounces - those which indicate permanent unrecoverable errors such as destination address no longer exists. In principle this can be distinguished using smtp response code. In practice, however, there are some challenges to make the distinction</p> <ul><li>the smtp response code is not fully standardized and may vary by recipient's smtp server so it's unreliable</li> <li>there is no standard smtp header in bounce email to contain smtp response code. Often the response code is embedded in bounce email body.</li> <li>the bounce email template varies by sender's smtp server</li></ul> <p>To mitigate, <em>NotifyBC</em> defines several customizable string pattern filters in terms of regular expression. Only bounce emails matched the filters count towards unsubscription threshold. It's a matter of trial-and-error to get the correct filter suitable to your smtp server.</p> <div class="custom-block tip"><p class="custom-block-title">to improve hard bounce recognition</p> <p>Send non-existing emails to several external email systems. Inspect the bounce messages for common string patterns. After gone live, review bounce records in web console from time to time to identify new bounce types and decide whether the bounce types qualify as hard bounce. To avoid false positives resulting in premature unsubscription, it is advisable to start with a high unsubscription threshold.</p></div> <p>Bounce handling involves four actions</p> <ul><li>during notification dispatching, envelop address is set to a <a href="https://en.wikipedia.org/wiki/Variable_envelope_return_path" target="_blank" rel="noopener noreferrer">VERP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in the form <em>bn-{subscriptionId}-{unsubscriptionCode}@{inboundSmtpServerDomain}</em> routed to <em>NotifyBC</em> <a href="/NotifyBC/docs/config-inboundSmtpServer/">inbound smtp server</a>.</li> <li>when a notification finished dispatching, the dispatching start and end time is recorded to all bounce records matching affects recipient addresses</li> <li>when inbound smtp server receives a bounce message, it updates the bounce record by saving the message and incrementing the hard bounce count when the message matches the filter criteria. The filter criteria are regular expressions matched against bounce email subject and body, as well as regular expression to extract recipient's email address from bounce email body. It also unsubscribes the user from all subscriptions when the hard bounce count exceeds a predefined threshold.</li> <li>A cron job runs periodically to delete bounce records if the latest notification is deemed delivered successfully.</li></ul> <p>To setup bounce handling</p> <ul><li><p>set up <a href="/NotifyBC/docs/config-inboundSmtpServer/">inbound smtp server</a></p></li> <li><p>verify config <em>notification.handleBounce</em> is set to true or absent in <em>/src/config.local.js</em></p></li> <li><p>verify and adjust unsubscription threshold and bounce filter criteria if needed.
Following is the default config in file <em>/src/config.ts</em> compatible with <a href="https://tools.ietf.org/html/rfc3464" target="_blank" rel="noopener noreferrer">rfc 3464<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">module</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  inboundSmtpServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    bounce<span class="token operator">:</span> <span class="token punctuation">{</span>
      unsubThreshold<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      subjectRegex<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      smtpStatusCodeRegex<span class="token operator">:</span> <span class="token string">'5\\.\\d{1,3}\\.\\d{1,3}'</span><span class="token punctuation">,</span>
      failedRecipientRegex<span class="token operator">:</span>
        <span class="token string">'(?:[a-z0-9!#$%&amp;\'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&amp;\'*+/=?^_`{|}~-]+)*|&quot;(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*&quot;)@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>where</p> <ul><li><p><em>unsubThreshold</em> is the threshold of hard bounce count above which the user is unsubscribed from all subscriptions</p></li> <li><p><em>subjectRegex</em> is the regular expression that bounce message subject must match in order to count towards the threshold. If <em>subjectRegex</em> is set to empty string or <em>undefined</em>, then this filter is disabled.</p></li> <li><p><em>smtpStatusCodeRegex</em> is the regular expression that smtp status code embedded in the message body must match in order to count towards the threshold. The default value matches all <a href="https://tools.ietf.org/html/rfc3463" target="_blank" rel="noopener noreferrer">rfc3463<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> class 5 status codes. For a multi-part bounce message, the body limits to the one of the following parts by content type in descending order</p> <ul><li><em>message/delivery-status</em></li> <li>html</li> <li>plain text</li></ul></li> <li><p><em>failedRecipientRegex</em> is the regular expression used to extract recipient's email address from bounce message body. This extracted recipient's email address is compared against the subscription record as a means of validation. If <em>failedRecipientRegex</em> is set to empty string or <em>undefined</em>, then this validation method is skipped. The default RegEx is taken from a <a href="https://stackoverflow.com/questions/201323/how-to-validate-an-email-address-using-a-regular-expression" target="_blank" rel="noopener noreferrer">stackoverflow answer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. For a multi-part bounce message, the body limits to the one of the following parts by content type in descending order</p> <ul><li><em>message/delivery-status</em></li> <li>html</li> <li>plain text</li></ul></li></ul></li> <li><p>Change config of cron job <a href="/NotifyBC/docs/config-cronJobs/#delete-notification-bounces">Delete Notification Bounces</a> if needed</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NotifyBC/docs/config-listUnsubscribeByEmail/" class="prev">
        List-unsubscribe by Email
      </a></span> <span class="next"><a href="/NotifyBC/docs/config-workerProcessCount/">
        Worker Process Count
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/NotifyBC/assets/js/app.47c10ac5.js" defer></script><script src="/NotifyBC/assets/js/4.a700b1f7.js" defer></script><script src="/NotifyBC/assets/js/5.cf402d1d.js" defer></script><script src="/NotifyBC/assets/js/27.54e89f3a.js" defer></script>
  </body>
</html>
