<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" type="image/x-icon" href="/NotifyBC/preview/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title>Subscription | NotifyBC</title><meta name="description" content="A versatile notification API server">
    <link rel="preload" href="/NotifyBC/preview/assets/style-8fbc3cfb.css" as="style"><link rel="stylesheet" href="/NotifyBC/preview/assets/style-8fbc3cfb.css">
    <link rel="modulepreload" href="/NotifyBC/preview/assets/app-0db8f21c.js"><link rel="modulepreload" href="/NotifyBC/preview/assets/index.html-3d37ae4c.js"><link rel="modulepreload" href="/NotifyBC/preview/assets/index.html-e7b8f791.js"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-692e45cb.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-7d2ae716.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-74e8fbb1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-15fde261.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-d6481ba1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-09f857ca.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-70c61dd5.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-f8b7a659.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-ced62edd.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-88fcd172.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a2d4ab5c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6b858d80.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-549ff1f9.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6e94f439.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-c46be575.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a70b6cf1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a9eb55a1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-f9768eb1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6bb621c5.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-bc520f9b.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-42466a4a.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-3bc7b1c6.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-caa38aac.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-34c15120.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-2fb78bd6.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-963a4ecf.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-1d87c569.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a0e9a4ad.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-76d114a5.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-cdc6dd62.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-fae03536.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6ca7c7e1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-568e376b.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-ccd9b97c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-4c2b215a.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-602c2540.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParam.html-d51cd871.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-36da1075.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-322c82ef.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-5fd85c3d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-546f83b2.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-d290da74.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-e9807ca8.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-b7c3493f.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-e6ef4ba6.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-101bd9a8.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-dfc9a442.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-c2e34df8.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-fa8ccbcd.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-8db78858.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-3808b137.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-e9a74cec.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-4d8e0274.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-ad42a511.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-f21e686d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-190205fd.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-07fdc891.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-3d0c5850.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-e665e981.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-0424234a.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-1f12a26c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-71377645.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-3608555d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-3804d0e3.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6a578d59.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-2044c349.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a9b49bcd.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-83d4b2ac.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-7526fb81.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-ca926b9f.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a6883c1c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-818aa04f.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-5920ab5d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParam.html-d0957abd.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/404.html-94f00246.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><div class="nb-navbar-brand"><a href="/NotifyBC/preview/" class=""><img class="logo" src="/NotifyBC/preview/img/logo.svg" alt="NotifyBC"></a><!----></div></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/NotifyBC/preview/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/docs/" class="router-link-active" aria-label="Docs"><!--[--><!--]--> Docs <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/help/" class="" aria-label="Help"><!--[--><!--]--> Help <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/bcgov/notifybc" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/NotifyBC/preview/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/docs/" class="router-link-active" aria-label="Docs"><!--[--><!--]--> Docs <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/help/" class="" aria-label="Help"><!--[--><!--]--> Help <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/bcgov/notifybc" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Getting Started <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/" class="router-link-active sidebar-item" aria-label="Welcome"><!--[--><!--]--> Welcome <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/overview/" class="sidebar-item" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/quickstart/" class="sidebar-item" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/installation/" class="sidebar-item" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/web-console/" class="sidebar-item" aria-label="Web Console"><!--[--><!--]--> Web Console <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/what&#39;s-new/" class="sidebar-item" aria-label="What&#39;s New"><!--[--><!--]--> What&#39;s New <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Configuration <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/config-overview/" class="sidebar-item" aria-label="Configuration Overview"><!--[--><!--]--> Configuration Overview <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-database/" class="sidebar-item" aria-label="Database"><!--[--><!--]--> Database <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-adminIpList/" class="sidebar-item" aria-label="Admin IP List"><!--[--><!--]--> Admin IP List <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-reverseProxyIpLists/" class="sidebar-item" aria-label="Reverse Proxy IP Lists"><!--[--><!--]--> Reverse Proxy IP Lists <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-httpHost/" class="sidebar-item" aria-label="HTTP Host"><!--[--><!--]--> HTTP Host <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-internalHttpHost/" class="sidebar-item" aria-label="Internal HTTP Host"><!--[--><!--]--> Internal HTTP Host <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-email/" class="sidebar-item" aria-label="Email"><!--[--><!--]--> Email <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-sms/" class="sidebar-item" aria-label="SMS"><!--[--><!--]--> SMS <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-subscription/" class="sidebar-item" aria-label="Subscription"><!--[--><!--]--> Subscription <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-notification/" class="sidebar-item" aria-label="Notification"><!--[--><!--]--> Notification <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-nodeRoles/" class="sidebar-item" aria-label="Node Roles"><!--[--><!--]--> Node Roles <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-cronJobs/" class="sidebar-item" aria-label="Cron Jobs"><!--[--><!--]--> Cron Jobs <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-rsaKeys/" class="sidebar-item" aria-label="RSA Keys"><!--[--><!--]--> RSA Keys <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-workerProcessCount/" class="sidebar-item" aria-label="Worker Process Count"><!--[--><!--]--> Worker Process Count <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-middleware/" class="sidebar-item" aria-label="Middleware"><!--[--><!--]--> Middleware <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-oidc/" class="sidebar-item" aria-label="OIDC"><!--[--><!--]--> OIDC <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-certificates/" class="sidebar-item" aria-label="TLS Certificates"><!--[--><!--]--> TLS Certificates <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">API <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/api-overview/" class="sidebar-item" aria-label="API Overview"><!--[--><!--]--> API Overview <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Subscription"><!--[--><!--]--> Subscription <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#model-schema" class="router-link-active router-link-exact-active sidebar-item" aria-label="Model Schema"><!--[--><!--]--> Model Schema <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#get-subscriptions" class="router-link-active router-link-exact-active sidebar-item" aria-label="Get Subscriptions"><!--[--><!--]--> Get Subscriptions <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#get-subscription-count" class="router-link-active router-link-exact-active sidebar-item" aria-label="Get Subscription Count"><!--[--><!--]--> Get Subscription Count <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#create-a-subscription" class="router-link-active router-link-exact-active sidebar-item" aria-label="Create a Subscription"><!--[--><!--]--> Create a Subscription <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#verify-a-confirmation-code" class="router-link-active router-link-exact-active sidebar-item" aria-label="Verify a Confirmation Code"><!--[--><!--]--> Verify a Confirmation Code <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#update-a-subscription" class="router-link-active router-link-exact-active sidebar-item" aria-label="Update a Subscription"><!--[--><!--]--> Update a Subscription <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#delete-a-subscription-unsubscribing" class="router-link-active router-link-exact-active sidebar-item" aria-label="Delete a Subscription (unsubscribing)"><!--[--><!--]--> Delete a Subscription (unsubscribing) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#un-deleting-a-subscription" class="router-link-active router-link-exact-active sidebar-item" aria-label="Un-deleting a Subscription"><!--[--><!--]--> Un-deleting a Subscription <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#get-all-services-with-confirmed-subscribers" class="router-link-active router-link-exact-active sidebar-item" aria-label="Get all services with confirmed subscribers"><!--[--><!--]--> Get all services with confirmed subscribers <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/api-subscription/#replace-a-subscription" class="router-link-active router-link-exact-active sidebar-item" aria-label="Replace a Subscription"><!--[--><!--]--> Replace a Subscription <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/NotifyBC/preview/docs/api-notification/" class="sidebar-item" aria-label="Notification"><!--[--><!--]--> Notification <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-config/" class="sidebar-item" aria-label="Configuration"><!--[--><!--]--> Configuration <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-administrator/" class="sidebar-item" aria-label="Administrator"><!--[--><!--]--> Administrator <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-bounce/" class="sidebar-item" aria-label="Bounce"><!--[--><!--]--> Bounce <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Miscellaneous <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/benchmarks/" class="sidebar-item" aria-label="Benchmarks"><!--[--><!--]--> Benchmarks <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/bulk-import/" class="sidebar-item" aria-label="Bulk Import"><!--[--><!--]--> Bulk Import <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/developer-notes/" class="sidebar-item" aria-label="Developer Notes"><!--[--><!--]--> Developer Notes <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/upgrade/" class="sidebar-item" aria-label="Upgrade Guide"><!--[--><!--]--> Upgrade Guide <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Meta <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/conduct/" class="sidebar-item" aria-label="Code of Conduct"><!--[--><!--]--> Code of Conduct <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/acknowledgments/" class="sidebar-item" aria-label="Acknowledgments"><!--[--><!--]--> Acknowledgments <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="subscription" tabindex="-1"><a class="header-anchor" href="#subscription" aria-hidden="true">#</a> Subscription</h1><p>The subscription API encapsulates the backend workflow of user subscription and un-subscription of push notification service. Depending on whether a API call comes from user browser as a user request or from an authorized server as an admin request, <em>NotifyBC</em> applies different validation rules. For user requests, the notification channel entered by user is unconfirmed. A confirmation code will be associated with this request. The confirmation code can be created in one of two ways:</p><ul><li>by <em>NotifyBC</em> based on channel dependent <em>subscription.confirmationRequest.&lt;channel&gt;.confirmationCodeRegex</em> <a href="/NotifyBC/preview/docs/config-subscription/#confirmation-request-message" class="">config</a>.</li><li>by a trusted third party. This trusted third party encrypts the confirmation code using the public RSA key of the <em>NotifyBC</em> instance (see more about <a href="/NotifyBC/preview/docs/config-rsaKeys/" class="">RSA Key Config</a>) and pass the encrypted confirmation code to <em>NotifyBC</em> via user browser in the same subscription request. <em>NotifyBC</em> then decrypts to obtain the confirmation code. This method allows user subscribe to multiple notification services provided by <em>NotifyBC</em> instances in different trust domains (i.e. service providers) and only have to confirm the subscription channel once during one browser session. In such case only one <em>NotifyBC</em> instance should be chosen to deliver confirmation request to user.</li></ul><p>Equipped with the confirmation code and a message template, <em>NotifyBC</em> can now send out confirmation request to unconfirmed subscription channel. At a minimum this confirmation request should contain the confirmation code. When user receives the message, he/she echos the confirmation code back to a <em>NotifyBC</em> provided API to verify against saved record. If match, the state of the subscription request is changed to confirmed.</p><p>For admin requests, <em>NotifyBC</em> can still perform the above confirmation process. But admin request has full CRUD privilege, including set the subscription state to confirmed, bypassing the confirmation process.</p><p>The workflow of user subscribing to notification services offered by a single service provider is illustrated by sequence diagram below. In this case, the confirmation code is generated by <em>NotifyBC</em>. <img src="/NotifyBC/preview/img/subscription-single-service-provider.png" alt="single service provider subscription"></p><p>In the case user subscribing to notifications offered by different service providers in separate trust domains, the confirmation code is generated by a third-party server app trusted by all <em>NotifyBC</em> instances. Following sequence diagram shows the workflow. The diagram indicates <em>NotifyBC API Server 2</em> is chosen to send confirmation request.</p><img src="/NotifyBC/preview/img/subscription-multi-service-provider.png" alt="multi service provider subscription"><h2 id="model-schema" tabindex="-1"><a class="header-anchor" href="#model-schema" aria-hidden="true">#</a> Model Schema</h2><p>The API operates on following subscription data model fields:</p><table><tr><th>Name</th><th>Attributes</th></tr><tr><td><p class="name">serviceName</p><p class="description">name of the service. Avoid prefixing the name with underscore (_), or it may conflict with internal implementation.</p></td><td><table><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>true</td></tr></table></td></tr><tr><td><p class="name">channel</p><p class="description">name of the delivery channel. Valid values: email and sms. Notice inApp is invalid as in-app notification doesn&#39;t need subscription.</p></td><td><table><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>true</td></tr><tr><td>default</td><td>email</td></tr></table></td></tr><tr><td><p class="name">userChannelId</p><p class="description">user&#39;s delivery channel id, for example, email address</p></td><td><table><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>true</td></tr></table></td></tr><tr><td><p class="name">id</p><p class="description">subscription id</p></td><td><table><tr><td>type</td><td>string, format depends on db</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></table></td></tr><tr><td><p class="name">state</p><p class="description">state of subscription. Valid values: unconfirmed, confirmed, deleted</p></td><td><table><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr><tr><td>default</td><td>unconfirmed</td></tr></table></td></tr><tr><td><p class="name">userId</p><p class="description">user id. Auto-populated for authenticated user requests.</p></td><td><table><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr></table></td></tr><tr><td><p class="name">created</p><p class="description">date and time of creation</p></td><td><table><tr><td>type</td><td>date</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></table></td></tr><tr><td><p class="name">updated</p><p class="description">date and time of last update</p></td><td><table><tr><td>type</td><td>date</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></table></td></tr><tr><td><p class="name">confirmationRequest</p><div class="description">an object containing these child fields <ul><li><div class="name"> confirmationCodeRegex </div><ul><li>type: string</li><li>regular expression used to generate confirmation code </li></ul></li><li><div class="name"> confirmationCodeEncrypted </div><ul><li>type: string</li><li>encrypted confirmation code </li></ul></li><li><div class="name"> sendRequest </div><ul><li>type: boolean</li><li> whether to send confirmation request </li></ul></li><li><div class="name"> from, subject, textBody, htmlBody </div><ul><li>type: string</li><li> these are email template fields used for sending email confirmation request. If confirmationRequest.sendRequest is true and channel is email, then these fields should be supplied in order to send confirmation email. </li></ul></li></ul></div></td><td><table><tr><td>type</td><td>object</td></tr><tr><td>required</td><td>true for user request with encrypted confirmation code; false otherwise</td></tr></table></td></tr><tr><td><p class="name"><a name="broadcastPushNotificationFilter"></a>broadcastPushNotificationFilter</p><div class="description">a string conforming to jmespath <a href="http://jmespath.org/specification.html#filter-expressions">filter expressions syntax</a> after the question mark (?). The filter is matched against the <i><a href="../api-notification#data">data</a></i> field of broadcast push notification. Examples of filter <ul><li>simple <br><i>province == &#39;BC&#39;</i></li><li>calling jmespath&#39;s <a href="http://jmespath.org/specification.html#built-in-functions">built-in functions</a> <br><i>contains(province,&#39;B&#39;)</i></li><li>calling <a href="../config-notification/#broadcast-push-notification-custom-filter-functions">custom filter functions</a><br><i>contains_ci(province,&#39;b&#39;)</i></li><li>compound <br><i>(contains(province,&#39;BC&#39;) || contains_ci(province,&#39;b&#39;)) &amp;&amp; city == &#39;Victoria&#39; </i></li></ul> All of above filters will match data object <i>{&quot;province&quot;: &quot;BC&quot;, &quot;city&quot;: &quot;Victoria&quot;}</i></div></td><td><table><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr></table></td></tr><tr><td><p class="name"><a name="data"></a>data</p><p class="description">An object used by filter <a href="../api-notification#broadcastPushNotificationSubscriptionFilter">broadcastPushNotificationSubscriptionFilter</a> specified by the broadcast push notification sender to determine if the notification should be delivered to the subscriber.</p></td><td><table><tr><td>type</td><td>object</td></tr><tr><td>required</td><td>false</td></tr></table></td></tr><tr><td><p class="name">unsubscriptionCode</p><p class="description">generated randomly according to RegEx config <i>anonymousUnsubscription.code.regex</i> during anonymous subscription if config <i>anonymousUnsubscription.code.required</i> is set to true</p></td><td><table><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></table></td></tr><tr><td><p class="name">unsubscribedAdditionalServices</p><p class="description">generated if parameter <i>additionalServices</i> is supplied in unsubscription request. Contains 2 sub-fields: ids and names, each being a list identifying the additional unsubscribed subscriptions.</p></td><td><table><tr><td>type</td><td>object</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></table></td></tr></table><h2 id="get-subscriptions" tabindex="-1"><a class="header-anchor" href="#get-subscriptions" aria-hidden="true">#</a> Get Subscriptions</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /subscriptions
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>permissions required, one of <ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li>inputs <ul><li>a filter defining fields, where, include, order, offset, and limit. See <a href="https://loopback.io/doc/en/lb4/Querying-data.html" target="_blank" rel="noopener noreferrer">Loopback Querying Data<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for valid syntax and examples <ul><li>parameter name: filter</li><li>required: false</li><li>parameter type: query</li><li>data type: object</li></ul></li></ul></li><li>outcome <ul><li>for admin requests, returns unabridged array of subscription data matching the filter</li><li>for authenticated user requests, in addition to filter, following constraints are imposed on the returned array <ul><li>only non-deleted subscriptions</li><li>only subscriptions created by the user</li><li>the <em>confirmationRequest</em> field is removed.</li></ul></li><li>forbidden for anonymous user requests</li></ul></li></ul><h2 id="get-subscription-count" tabindex="-1"><a class="header-anchor" href="#get-subscription-count" aria-hidden="true">#</a> Get Subscription Count</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /subscriptions/count?where[property]=value
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>permissions required, one of</p><ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li><p>inputs</p><ul><li>a <a href="https://loopback.io/doc/en/lb4/Where-filter.html" target="_blank" rel="noopener noreferrer">where filter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><ul><li>parameter name: where</li><li>required: false</li><li>parameter type: query</li><li>data type: object</li></ul></li></ul></li><li><p>outcome</p><p>Validations rules are the same as <em>GET /subscriptions</em>. If passed, the output is a count of subscriptions matching the query</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> &lt;number&gt;
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>examples</p><p>See LoopBack <a href="http://loopback.io/doc/en/lb3/PersistedModel-REST-API.html#get-instance-count" target="_blank" rel="noopener noreferrer">Get instance count<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for examples.</p></li></ul><h2 id="create-a-subscription" tabindex="-1"><a class="header-anchor" href="#create-a-subscription" aria-hidden="true">#</a> Create a Subscription</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>POST /subscriptions
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>inputs</p><ul><li>an object containing subscription data model fields. At a minimum all required fields that don&#39;t have a default value must be supplied. Id field should be omitted since it&#39;s auto-generated. <ul><li>parameter name: data</li><li>required: true</li><li>parameter type: body</li><li>data type: object</li></ul></li></ul></li><li><p>outcome</p><p><em>NotifyBC</em> performs following actions in sequence</p><ol><li><p>inputs are validated. If validation fails, error is returned.</p></li><li><p>for user requests, the <em>state</em> field is forced to <em>unconfirmed</em></p></li><li><p>for authenticated user request, <em>userId</em> field is populated with authenticated userId</p></li><li><p>otherwise, <em>unsubscriptionCode</em> is generated if config <em>subscription.anonymousUnsubscription.code.required</em> is <em>true</em>, unless if the request is made by admin and the field is already populated</p></li><li><p>if <em>confirmationRequest.confirmationCodeEncrypted</em> is populated, a confirmation code is generated by decrypting this field using private RSA key, then put decrypted confirmation code to field <em>confirmationRequest.confirmationCode</em></p></li><li><p>otherwise, for user requests and for admin requests missing message template, the message template is set to configured value. Then, if <em>confirmationRequest.confirmationCodeRegex</em> is populated, a confirmation code is generated conforming to regex and put to field <em>confirmationRequest.confirmationCode</em></p></li><li><p>the subscription request is saved to database.</p></li><li><p>if <em>confirmationRequest.sendRequest</em> is true, then a message is sent to <em>userChannelId</em>. The message template is determined by</p><ol><li>if <em>detectDuplicatedSubscription</em> is true and there is already a confirmed subscription to the same <em>serviceName</em>, <em>channel</em> and <em>userChannelId</em>, then message is sent using <em>duplicatedSubscriptionNotification</em> as template;</li><li>otherwise, a confirmation request is sent to using the template fields in <em>confirmationRequest</em>.</li></ol><p><a href="/NotifyBC/preview/docs/overview/#mail-merge" class="">Mail merge</a> is performed on the template regardless.</p></li><li><p>The subscription data, including auto-generated id, is returned as response unless there is error when sending confirmation request or saving to database. For user request, some fields containing sensitive information such as <em>confirmationRequest</em> are removed prior to sending the response.</p></li></ol></li><li><p>examples</p><ol><li>To subscribe a user to service <em>education</em>, copy and paste following json object to the data value box in API explorer, change email addresses as needed, and click <em>Try it out!</em> button:</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{
  &quot;serviceName&quot;: &quot;education&quot;,
  &quot;channel&quot;: &quot;email&quot;,
  &quot;userChannelId&quot;: &quot;foo@bar.com&quot;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As a result, <em>foo@bar.com</em> should receive an email confirmation request, and following json object is returned to caller upon sending the email successfully for admin request:</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;serviceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;education&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;channel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;userChannelId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo@bar.com&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;unconfirmed&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;confirmationRequest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;confirmationCodeRegex&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\\d{5}&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sendRequest&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no_reply@bar.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;confirmation&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;textBody&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Enter {confirmation_code} on screen&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;confirmationCode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;45304&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2016-10-03T17:35:40.202Z&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;updated&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2016-10-03T17:35:40.202Z&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;57f296ec7eead50554c61de7&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For non-admin request, the field <em>confirmationRequest</em> is removed from response, and field <em>userId</em> is populated if request is authenticated:</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;serviceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;education&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;channel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;userChannelId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo@bar.com&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;unconfirmed&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;userId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;user_id&gt;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2016-10-03T18:17:09.778Z&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;updated&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2016-10-03T18:17:09.778Z&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;57f2a0a5b1aa0e2d5009eced&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><p>To subscribe a user to service <em>education</em> with RSA public key encrypted confirmation code supplied, POST following request</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;serviceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;education&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;channel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;userChannelId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo@bar.com&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;confirmationRequest&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;confirmationCodeEncrypted&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;encrypted-confirmation-code&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sendRequest&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no_reply@bar.com&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;subject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;confirmation&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;textBody&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Enter {confirmation_code} on screen&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As a result, <em>NotifyBC</em> will decrypt the confirmation code using the private RSA key, replace placeholder <em>{confirmation_code}</em> in the email template with the confirmation code, and send confirmation request to <em>foo@bar.com</em>.</p></li></ol></li></ul><h2 id="verify-a-confirmation-code" tabindex="-1"><a class="header-anchor" href="#verify-a-confirmation-code" aria-hidden="true">#</a> Verify a Confirmation Code</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /subscriptions/{id}/verify
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>inputs</p><ul><li>subscription id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li><li>confirmation code <ul><li>parameter name: confirmationCode</li><li>required: true</li><li>parameter type: query</li><li>data type: string</li></ul></li><li>whether or not replacing existing subscriptions <ul><li>parameter name: replace</li><li>required: false</li><li>parameter type: query</li><li>data type: boolean</li></ul></li></ul></li><li><p>outcome</p><p><em>NotifyBC</em> performs following actions in sequence</p><ol><li>the subscription identified by <em>id</em> is retrieved</li><li>for user request, the <em>userId</em> of the subscription is checked against current request user, if not match, error is returned; otherwise</li><li>input parameter <em>confirmationCode</em> is checked against <em>confirmationRequest.confirmationCode</em>. If not match, error is returned; otherwise</li><li>if input parameter <em>replace</em> is supplied and set to <em>true</em>, then existing confirmed subscriptions from the same <em>serviceName</em>, <em>channel</em> and <em>userChannelId</em> are deleted. No unsubscription acknowledgement notification is sent</li><li><em>state</em> is set to <em>confirmed</em></li><li>the subscription is saved back to database</li><li>displays acknowledgement message according to <a href="../config-subscription#confirmation-verification-acknowledgement-messages">configuration</a></li></ol></li></ul><h2 id="update-a-subscription" tabindex="-1"><a class="header-anchor" href="#update-a-subscription" aria-hidden="true">#</a> Update a Subscription</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PATCH /subscriptions/{id}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This API is used by authenticated user to change user channel id (such as email address) and resend confirmation code.</p><ul><li><p>permissions required, one of</p><ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li><p>inputs</p><ul><li>subscription id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li><li>an object containing fields to be updated. <ul><li>parameter name: data</li><li>required: true</li><li>parameter type: body</li><li>data type: object</li></ul></li></ul></li><li><p>outcome</p><p><em>NotifyBC</em> processes the request similarly as creating a subscription except during input validation it imposes following extra constraints to user request</p><ul><li>only fields <em>userChannelId</em>, <em>state</em> and <em>confirmationRequest</em> can be updated</li><li>when changing <em>userChannelId</em>, <em>confirmationRequest</em> must also be supplied</li><li>if <em>userChannelId</em> is different from the saved record, <em>state</em> is forced to <em>unconfirmed</em>.</li></ul></li></ul><h2 id="delete-a-subscription-unsubscribing" tabindex="-1"><a class="header-anchor" href="#delete-a-subscription-unsubscribing" aria-hidden="true">#</a> Delete a Subscription (unsubscribing)</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>DELETE /subscriptions/{id}?unsubscriptionCode={unsubscriptionCode}&amp;additionalServices[]={additionalServices}&amp;userChannelId={userChannelId}
or
GET /subscriptions/{id}/unsubscribe?unsubscriptionCode={unsubscriptionCode}&amp;additionalServices[]={additionalServices}&amp;userChannelId={userChannelId}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>inputs</p><ul><li>subscription id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li><li>unsubscription code for anonymous request <ul><li>parameter name: unsubscriptionCode</li><li>required: false</li><li>parameter type: query</li><li>data type: string</li></ul></li><li>additional service names to unsubscribe <ul><li>parameter name: additionalServices</li><li>required: false</li><li>parameter type: query</li><li>data type: array of strings. If there is only one item and its value is <em>_all</em>, then all services the user subscribed on this <em>NotifyBC</em> instance are included. Supply multiple items by repeating this query parameter.</li></ul></li><li>user channel id for extended validation <ul><li>parameter name: userChannelId</li><li>required: false</li><li>parameter type: query</li><li>data type: string</li></ul></li></ul></li><li><p>outcome</p><p><em>NotifyBC</em> performs following actions in sequence</p><ol><li>the subscription identified by <em>id</em> is retrieved</li><li>for user request,</li></ol><ul><li>if request is authenticated, the <em>userId</em> of the subscription is checked against current request user, if not match, request is rejected</li><li>if request is anonymous, and server is configured to require unsubscription code, the input unsubscription code is matched against the <em>unsubscriptionCode</em> field. Request is rejected if not match. In addition, if input parameter <em>userChannelId</em> is populated but doesn&#39;t match, request is rejected</li></ul><ol start="3"><li>if the subscription state is not <em>confirmed</em>, request is rejected</li><li>if <em>additionalServices</em> is populated, database is queried to retrieve the <em>serviceName</em> and <em>id</em> fields of the additional subscriptions</li><li>the field <em>state</em> is set to <em>deleted</em> for the subscription identified by <em>id</em> as well as additional subscriptions retrieved in previous step</li><li>if <em>additionalServices</em> is not empty, the service names and ids of the additional subscriptions are added to field <em>unsubscribedAdditionalServices</em> of the subscription identified by <em>id</em> to allow bulk undo unsubscription later on</li><li>for anonymous unsubscription, an acknowledgement notification is sent to user if configured so</li><li>returns</li></ol><ul><li>for anonymous request, either the message or redirect as configured in <em>anonymousUnsubscription.acknowledgements.onScreen</em></li><li>for authenticated user or admin requests, number of records affected or error message if occurred.</li></ul></li><li><p><a name="unsubscription-example"></a> examples</p><ol><li>To allow an anonymous subscriber to unsubscribe single subscription, provide url token <em>{unsubscription_url}</em> in notification messages. When sending notification, <a href="/NotifyBC/preview/docs/overview/#mail-merge" class="">mail merge</a> is performed on the token resolving to the GET API url and parameters.</li><li>To allow an anonymous subscriber to unsubscribe all subscriptions, provide url token <em>{unsubscription_all_url}</em> in notification messages.</li></ol></li></ul><h2 id="un-deleting-a-subscription" tabindex="-1"><a class="header-anchor" href="#un-deleting-a-subscription" aria-hidden="true">#</a> Un-deleting a Subscription</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /subscriptions/{id}/unsubscribe/undo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This API allows an anonymous subscriber to undo an unsubscription.</p><ul><li><p>inputs</p><ul><li>subscription id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li><li>unsubscription code <ul><li>parameter name: unsubscriptionCode</li><li>required: false</li><li>parameter type: query</li><li>data type: string</li></ul></li></ul></li><li><p>outcome</p><p><em>NotifyBC</em> performs following actions in sequence</p><ol><li>the subscription identified by <em>id</em> is retrieved</li><li>for user request,</li></ol><ul><li>if request is anonymous, and server is configured to require unsubscription code, the input unsubscription code is matched against the <em>unsubscriptionCode</em> field. Request is rejected if not match</li><li>if request is authenticated, request is rejected</li><li>if the subscription state is not <em>deleted</em>, request is rejected</li></ul><ol start="3"><li>the field <em>state</em> is set to <em>confirmed</em> for the subscription identified by <em>id</em> as well as additional subscriptions identified in field <em>unsubscribedAdditionalServices</em>, if populated</li><li>field <em>unsubscribedAdditionalServices</em> is removed if populated</li><li>returns either the message or redirect as configured in <em><a href="/NotifyBC/preview/docs/config-subscription/#anonymousUndoUnsubscription" class="">anonymousUndoUnsubscription</a></em></li></ol></li><li><p>example</p><p>To allow an anonymous subscriber to undo unsubscription, provide link token <em>{unsubscription_reversion_url}</em> in unsubscription acknowledgement notification, which is by default set. When sending notification, <a href="/NotifyBC/preview/docs/overview/#mail-merge" class="">mail merge</a> is performed on this token resolving to the API url and parameters.</p></li></ul><h2 id="get-all-services-with-confirmed-subscribers" tabindex="-1"><a class="header-anchor" href="#get-all-services-with-confirmed-subscribers" aria-hidden="true">#</a> Get all services with confirmed subscribers</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GET /subscriptions/services
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This API is designed to facilitate implementing autocomplete for admin web console.</p><ul><li>permissions required, one of <ul><li>super admin</li><li>admin</li></ul></li><li>inputs - none</li><li>outcome <ul><li>for admin requests, returns an array of unique service names with confirmed subscribers</li><li>forbidden for non-admin requests</li></ul></li></ul><h2 id="replace-a-subscription" tabindex="-1"><a class="header-anchor" href="#replace-a-subscription" aria-hidden="true">#</a> Replace a Subscription</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>PUT /subscriptions/{id}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This API is intended to be only used by admin web console to modify a subscription without triggering any confirmation or acknowledgement notification.</p><ul><li>permissions required, one of <ul><li>super admin</li><li>admin</li></ul></li><li>permissions required, one of <ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li>inputs <ul><li>subscription id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li><li>subscription data <ul><li>parameter name: data</li><li>required: true</li><li>parameter type: body</li><li>data type: object</li></ul></li></ul></li><li>outcome <ul><li>for admin requests, replace subscription identified by <em>id</em> with parameter <em>data</em> and save to database. No notification is sent.</li><li>forbidden for non-admin requests</li></ul></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/NotifyBC/preview/docs/api-overview/" class="" aria-label="API Overview"><!--[--><!--]--> API Overview <!--[--><!--]--></a></span><span class="next"><a href="/NotifyBC/preview/docs/api-notification/" class="" aria-label="Notification"><!--[--><!--]--> Notification <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/NotifyBC/preview/assets/app-0db8f21c.js" defer></script>
  </body>
</html>
