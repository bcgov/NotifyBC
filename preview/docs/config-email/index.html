<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" type="image/x-icon" href="/NotifyBC/preview/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title>Email | NotifyBC</title><meta name="description" content="A versatile notification API server">
    <link rel="preload" href="/NotifyBC/preview/assets/style-8fbc3cfb.css" as="style"><link rel="stylesheet" href="/NotifyBC/preview/assets/style-8fbc3cfb.css">
    <link rel="modulepreload" href="/NotifyBC/preview/assets/app-3a4387b4.js"><link rel="modulepreload" href="/NotifyBC/preview/assets/index.html-ddb6006a.js"><link rel="modulepreload" href="/NotifyBC/preview/assets/index.html-6b858d80.js"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-692e45cb.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-7d2ae716.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-7dc4890d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-15fde261.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-93ff6c80.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-09f857ca.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-70c61dd5.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a7337040.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-f8b7a659.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-ced62edd.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-88fcd172.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a2d4ab5c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-549ff1f9.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6e94f439.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-c46be575.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a70b6cf1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a9eb55a1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-f9768eb1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6bb621c5.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-bc520f9b.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-42466a4a.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-3bc7b1c6.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-caa38aac.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-34c15120.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-2fb78bd6.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-963a4ecf.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-1d87c569.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a0e9a4ad.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-76d114a5.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-cdc6dd62.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-fae03536.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6ca7c7e1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-568e376b.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-ccd9b97c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-4c2b215a.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-602c2540.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParam.html-d51cd871.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParamCode.html-293978be.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParamExample.html-c90c301f.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/jmespathFilter.html-7c48b0c1.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/whereQueryParam.html-10f3d62d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/whereQueryParamCode.html-33176c09.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/whereQueryParamExample.html-68248e1c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-b059712b.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-7bfa383e.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-c22e0676.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-c7fe0a88.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-e05a7744.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-34862421.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-28ea99d9.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-c3f3aaee.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-e7a0f109.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6d627e3f.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-6badba54.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-e6c5e783.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-9dee3ffe.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-b34fe241.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-765923b8.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-f156f941.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-942e8053.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-8da7c9bf.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-64c3a702.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-89416d8b.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-327a4f9e.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-64c37283.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-d3ce220e.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a4d68973.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-d92009e4.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-9340fee4.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-8433c15b.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-8a40c20c.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-7e0e7bfc.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-a462151d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-2aa9df37.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-c750f9da.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-348fcb7a.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-1df41b83.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-4a7e4936.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index.html-5c2186c8.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParam.html-643c2a8d.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParamCode.html-0e1eb3a5.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/filterQueryParamExample.html-ba531aa8.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/jmespathFilter.html-1576a579.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/whereQueryParam.html-6b32fc3f.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/whereQueryParamCode.html-e8a1d61f.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/whereQueryParamExample.html-f73a99f0.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/404.html-0a8ab580.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/NotifyBC/preview/assets/index-5161ad19.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><div class="nb-navbar-brand"><a href="/NotifyBC/preview/" class=""><img class="logo" src="/NotifyBC/preview/img/logo.svg" alt="NotifyBC"></a><!----></div></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/NotifyBC/preview/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/docs/" class="router-link-active" aria-label="Docs"><!--[--><!--]--> Docs <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/help/" class="" aria-label="Help"><!--[--><!--]--> Help <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/bcgov/notifybc" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/NotifyBC/preview/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/docs/" class="router-link-active" aria-label="Docs"><!--[--><!--]--> Docs <!--[--><!--]--></a></div><div class="navbar-item"><a href="/NotifyBC/preview/help/" class="" aria-label="Help"><!--[--><!--]--> Help <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/bcgov/notifybc" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Getting Started <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/" class="router-link-active sidebar-item" aria-label="Welcome"><!--[--><!--]--> Welcome <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/overview/" class="sidebar-item" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/quickstart/" class="sidebar-item" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/installation/" class="sidebar-item" aria-label="Installation"><!--[--><!--]--> Installation <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/web-console/" class="sidebar-item" aria-label="Web Console"><!--[--><!--]--> Web Console <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/what&#39;s-new/" class="sidebar-item" aria-label="What&#39;s New"><!--[--><!--]--> What&#39;s New <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">Configuration <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/config-overview/" class="sidebar-item" aria-label="Configuration Overview"><!--[--><!--]--> Configuration Overview <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-database/" class="sidebar-item" aria-label="Database"><!--[--><!--]--> Database <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-adminIpList/" class="sidebar-item" aria-label="Admin IP List"><!--[--><!--]--> Admin IP List <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-reverseProxyIpLists/" class="sidebar-item" aria-label="Reverse Proxy IP Lists"><!--[--><!--]--> Reverse Proxy IP Lists <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-httpHost/" class="sidebar-item" aria-label="HTTP Host"><!--[--><!--]--> HTTP Host <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-internalHttpHost/" class="sidebar-item" aria-label="Internal HTTP Host"><!--[--><!--]--> Internal HTTP Host <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/config-email/" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Email"><!--[--><!--]--> Email <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/NotifyBC/preview/docs/config-email/#smtp" class="router-link-active router-link-exact-active sidebar-item" aria-label="SMTP"><!--[--><!--]--> SMTP <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/config-email/#throttle" class="router-link-active router-link-exact-active sidebar-item" aria-label="Throttle"><!--[--><!--]--> Throttle <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/config-email/#inbound-smtp-server" class="router-link-active router-link-exact-active sidebar-item" aria-label="Inbound SMTP Server"><!--[--><!--]--> Inbound SMTP Server <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/config-email/#bounce" class="router-link-active router-link-exact-active sidebar-item" aria-label="Bounce"><!--[--><!--]--> Bounce <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/NotifyBC/preview/docs/config-email/#list-unsubscribe-by-email" class="router-link-active router-link-exact-active sidebar-item" aria-label="List-unsubscribe by Email"><!--[--><!--]--> List-unsubscribe by Email <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/NotifyBC/preview/docs/config-sms/" class="sidebar-item" aria-label="SMS"><!--[--><!--]--> SMS <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-subscription/" class="sidebar-item" aria-label="Subscription"><!--[--><!--]--> Subscription <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-notification/" class="sidebar-item" aria-label="Notification"><!--[--><!--]--> Notification <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-nodeRoles/" class="sidebar-item" aria-label="Node Roles"><!--[--><!--]--> Node Roles <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-cronJobs/" class="sidebar-item" aria-label="Cron Jobs"><!--[--><!--]--> Cron Jobs <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-rsaKeys/" class="sidebar-item" aria-label="RSA Keys"><!--[--><!--]--> RSA Keys <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-workerProcessCount/" class="sidebar-item" aria-label="Worker Process Count"><!--[--><!--]--> Worker Process Count <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-middleware/" class="sidebar-item" aria-label="Middleware"><!--[--><!--]--> Middleware <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-oidc/" class="sidebar-item" aria-label="OIDC"><!--[--><!--]--> OIDC <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/config-certificates/" class="sidebar-item" aria-label="TLS Certificates"><!--[--><!--]--> TLS Certificates <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">API <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/api-overview/" class="sidebar-item" aria-label="API Overview"><!--[--><!--]--> API Overview <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-subscription/" class="sidebar-item" aria-label="Subscription"><!--[--><!--]--> Subscription <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-notification/" class="sidebar-item" aria-label="Notification"><!--[--><!--]--> Notification <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-config/" class="sidebar-item" aria-label="Configuration"><!--[--><!--]--> Configuration <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-administrator/" class="sidebar-item" aria-label="Administrator"><!--[--><!--]--> Administrator <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/api-bounce/" class="sidebar-item" aria-label="Bounce"><!--[--><!--]--> Bounce <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Miscellaneous <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/benchmarks/" class="sidebar-item" aria-label="Benchmarks"><!--[--><!--]--> Benchmarks <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/bulk-import/" class="sidebar-item" aria-label="Bulk Import"><!--[--><!--]--> Bulk Import <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/developer-notes/" class="sidebar-item" aria-label="Developer Notes"><!--[--><!--]--> Developer Notes <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/upgrade/" class="sidebar-item" aria-label="Upgrade Guide"><!--[--><!--]--> Upgrade Guide <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Meta <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/NotifyBC/preview/docs/conduct/" class="sidebar-item" aria-label="Code of Conduct"><!--[--><!--]--> Code of Conduct <!--[--><!--]--></a><!----></li><li><a href="/NotifyBC/preview/docs/acknowledgments/" class="sidebar-item" aria-label="Acknowledgments"><!--[--><!--]--> Acknowledgments <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="email" tabindex="-1"><a class="header-anchor" href="#email" aria-hidden="true">#</a> Email</h1><h2 id="smtp" tabindex="-1"><a class="header-anchor" href="#smtp" aria-hidden="true">#</a> SMTP</h2><p>By default <em>NotifyBC</em> acts as the SMTP server itself and connects directly to recipient&#39;s SMTP server. To setup SMTP relay to a host, say <em>smtp.foo.com</em>, add following <em>smtp</em> config object to <em>/src/config.local.js</em></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">smtp</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;smtp.foo.com&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
      <span class="token literal-property property">pool</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">tls</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">rejectUnauthorized</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Check out <a href="https://nodemailer.com/smtp/" target="_blank" rel="noopener noreferrer">Nodemailer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for other config options that you can define in <em>smtp</em> object. Using SMTP relay and fine-tuning some options are critical for performance. See <a href="/NotifyBC/preview/docs/benchmarks/#advices" class="">benchmark advices</a>.</p><h2 id="throttle" tabindex="-1"><a class="header-anchor" href="#throttle" aria-hidden="true">#</a> Throttle</h2><p><em>NotifyBC</em> can throttle email requests if SMTP server imposes rate limit. To enable throttle and set rate limit, create following config in file <em>/src/config.local.js</em></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">throttle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// minimum request interval in ms</span>
      <span class="token literal-property property">minTime</span><span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>where</p><ul><li><em>enabled</em> - whether to enable throttle or not. Default to <em>false</em>.</li><li><em>minTime</em> - minimum request interval in ms. Example value 250 throttles request rate to 4/sec.</li></ul><p>When <em>NotifyBC</em> is deployed from source code, by default the rate limit applies to one Node.js process only. If there are multiple processes, i.e. a cluster, the aggregated rate limit is multiplied by the number of processes. To enforce the rate limit across entire cluster, install Redis and add Redis config to <em>email.throttle</em></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">throttle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// minimum request interval in ms</span>
      <span class="token literal-property property">minTime</span><span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
      <span class="token comment">/* Redis clustering options */</span>
      <span class="token literal-property property">datastore</span><span class="token operator">:</span> <span class="token string">&#39;ioredis&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">clientOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">6379</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you installed Redis Sentinel,</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">throttle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// minimum request interval in ms</span>
      <span class="token literal-property property">minTime</span><span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
      <span class="token comment">/* Redis clustering options */</span>
      <span class="token literal-property property">datastore</span><span class="token operator">:</span> <span class="token string">&#39;ioredis&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">clientOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;mymaster&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sentinels</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">&#39;127.0.0.1&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">26379</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Throttle is implemented using <a href="https://github.com/SGrondin/bottleneck" target="_blank" rel="noopener noreferrer">Bottleneck<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://github.com/luin/ioredis" target="_blank" rel="noopener noreferrer">ioredis<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. See their documentations for more configurations.</p><p>When <em>NotifyBC</em> is deployed to Kubernetes using Helm, by default throttle, if enabled, uses Redis Sentinel therefore rate limit applies to whole cluster.</p><h2 id="inbound-smtp-server" tabindex="-1"><a class="header-anchor" href="#inbound-smtp-server" aria-hidden="true">#</a> Inbound SMTP Server</h2><p><em>NotifyBC</em> implemented an inbound SMTP server to handle</p><ul><li><a href="#bounce">bounce</a></li><li><a href="#list-unsubscribe-by-email">list-unsubscribe by email</a></li></ul><p>In order for the emails from internet to reach the SMTP server, a host where one of the following servers should be listening on port 25 open to internet</p><ol><li><em>NotifyBC</em>, if it can be installed on such internet-facing host directly; otherwise,</li><li>a tcp proxy server, such as nginx with stream proxy module that can proxy tcp port 25 traffic to backend <em>NotifyBC</em> instances.</li></ol><p>Regardless which above option is chosen, you need to config <em>NotifyBC</em> inbound SMTP server by adding following static config <em>email.inboundSmtpServer</em> to file <em>/src/config.local.js</em></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">inboundSmtpServer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token string">&#39;host.foo.com&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">listeningSmtpPort</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>where</p><ul><li><em>enabled</em> enables/disables the inbound SMTP server with default to <em>true</em>.</li><li><em>domain</em> is the internet-facing host domain. It has no default so <strong>must be set</strong>.</li><li><em>listeningSmtpPort</em> should be set to 25 if option 1 above is chosen. For options 2, <em>listeningSmtpPort</em> can be set to any opening port. On Unix, <em>NotifyBC</em> has to be run under <em>root</em> account to bind to port 25. If missing, <em>NotifyBC</em> will randomly select an available port upon launch which is usually undesirable so it <strong>should be set</strong>.</li><li>optional <em>options</em> object defines the behavior of <a href="https://nodemailer.com/extras/smtp-server/#step-3-create-smtpserver-instance" target="_blank" rel="noopener noreferrer">Nodemailer SMTP Server<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li></ul><div class="custom-container warning"><p class="custom-container-title">Inbound SMTP Server on OpenShift</p><p>OpenShift deployment template deploys an inbound SMTP server. Due to the limitation that OpenShift can only expose port 80 and 443 to external, to use the SMTP server, you have to setup a TCP proxy server (i.e. option 2). The inbound SMTP server is exposed as ${INBOUND_SMTP_DOMAIN}:443 , where ${INBOUND_SMTP_DOMAIN} is a template parameter which in absence, a default domain will be created. Configure your TCP proxy server to route traffic to ${INBOUND_SMTP_DOMAIN}:443 over TLS.</p></div><h3 id="tcp-proxy-server" tabindex="-1"><a class="header-anchor" href="#tcp-proxy-server" aria-hidden="true">#</a> TCP Proxy Server</h3><p>If <em>NotifyBC</em> is not able to bind to port 25 that opens to internet, perhaps due to firewall restriction, you can setup a TCP Proxy Server such as Nginx with <a href="http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html" target="_blank" rel="noopener noreferrer">ngx_stream_proxy_module<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. For example, the following nginx config will proxy SMTP traffic from port 25 to a <em>NotifyBC</em> inbound SMTP server running on OpenShift</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>stream {
    server {
        listen 25;
        proxy_pass ${INBOUND_SMTP_DOMAIN}:443;
        proxy_ssl on;
        proxy_ssl_verify off;
        proxy_ssl_server_name on;
        proxy_connect_timeout 10s;
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Replace <em>${INBOUND_SMTP_DOMAIN}</em> with the inbound SMTP server route domain.</p><h2 id="bounce" tabindex="-1"><a class="header-anchor" href="#bounce" aria-hidden="true">#</a> Bounce</h2><p>Bounces, or Non-Delivery Reports (NDRs), are system-generated emails informing sender of failed delivery. <em>NotifyBC</em> can be configured to receive bounces, record bounces, and automatically unsubscribe all subscriptions of a recipient if the number of recorded hard bounces against the recipient exceeds threshold. A deemed successful notification delivery deletes the bounce record.</p><p>Although <em>NotifyBC</em> records all bounce emails, not all of them should count towards unsubscription threshold, but rather only the hard bounces - those which indicate permanent unrecoverable errors such as destination address no longer exists. In principle this can be distinguished using smtp response code. In practice, however, there are some challenges to make the distinction</p><ul><li>the smtp response code is not fully standardized and may vary by recipient&#39;s smtp server so it&#39;s unreliable</li><li>there is no standard smtp header in bounce email to contain smtp response code. Often the response code is embedded in bounce email body.</li><li>the bounce email template varies by sender&#39;s smtp server</li></ul><p>To mitigate, <em>NotifyBC</em> defines several customizable string pattern filters in terms of regular expression. Only bounce emails matched the filters count towards unsubscription threshold. It&#39;s a matter of trial-and-error to get the correct filter suitable to your smtp server.</p><div class="custom-container tip"><p class="custom-container-title">to improve hard bounce recognition</p><p>Send non-existing emails to several external email systems. Inspect the bounce messages for common string patterns. After gone live, review bounce records in web console from time to time to identify new bounce types and decide whether the bounce types qualify as hard bounce. To avoid false positives resulting in premature unsubscription, it is advisable to start with a high unsubscription threshold.</p></div><p>Bounce handling involves four actions</p><ul><li>during notification dispatching, envelop address is set to a <a href="https://en.wikipedia.org/wiki/Variable_envelope_return_path" target="_blank" rel="noopener noreferrer">VERP<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> in the form <em>bn-{subscriptionId}-{unsubscriptionCode}@{inboundSmtpServerDomain}</em> routed to <em>NotifyBC</em> inbound smtp server.</li><li>when a notification finished dispatching, the dispatching start and end time is recorded to all bounce records matching affects recipient addresses</li><li>when inbound smtp server receives a bounce message, it updates the bounce record by saving the message and incrementing the hard bounce count when the message matches the filter criteria. The filter criteria are regular expressions matched against bounce email subject and body, as well as regular expression to extract recipient&#39;s email address from bounce email body. It also unsubscribes the user from all subscriptions when the hard bounce count exceeds a predefined threshold.</li><li>A cron job runs periodically to delete bounce records if the latest notification is deemed delivered successfully.</li></ul><p>To setup bounce handling</p><ul><li><p>set up <a href="#inbound-smtp-server">inbound smtp server</a></p></li><li><p>verify config <em>email.bounce.enabled</em> is set to true or absent in <em>/src/config.local.js</em></p></li><li><p>verify and adjust unsubscription threshold and bounce filter criteria if needed. Following is the default config in file <em>/src/config.ts</em> compatible with <a href="https://tools.ietf.org/html/rfc3464" target="_blank" rel="noopener noreferrer">rfc 3464<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  email<span class="token operator">:</span> <span class="token punctuation">{</span>
    bounce<span class="token operator">:</span> <span class="token punctuation">{</span>
      enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      unsubThreshold<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      subjectRegex<span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      smtpStatusCodeRegex<span class="token operator">:</span> <span class="token string">&#39;5\\.\\d{1,3}\\.\\d{1,3}&#39;</span><span class="token punctuation">,</span>
      failedRecipientRegex<span class="token operator">:</span>
        <span class="token string">&#39;(?:[a-z0-9!#$%&amp;\&#39;*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&amp;\&#39;*+/=?^_`{|}~-]+)*|&quot;(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*&quot;)@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>where</p><ul><li><p><em>unsubThreshold</em> is the threshold of hard bounce count above which the user is unsubscribed from all subscriptions</p></li><li><p><em>subjectRegex</em> is the regular expression that bounce message subject must match in order to count towards the threshold. If <em>subjectRegex</em> is set to empty string or <em>undefined</em>, then this filter is disabled.</p></li><li><p><em>smtpStatusCodeRegex</em> is the regular expression that smtp status code embedded in the message body must match in order to count towards the threshold. The default value matches all <a href="https://tools.ietf.org/html/rfc3463" target="_blank" rel="noopener noreferrer">rfc3463<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> class 5 status codes. For a multi-part bounce message, the body limits to the one of the following parts by content type in descending order</p><ul><li><em>message/delivery-status</em></li><li>html</li><li>plain text</li></ul></li><li><p><em>failedRecipientRegex</em> is the regular expression used to extract recipient&#39;s email address from bounce message body. This extracted recipient&#39;s email address is compared against the subscription record as a means of validation. If <em>failedRecipientRegex</em> is set to empty string or <em>undefined</em>, then this validation method is skipped. The default RegEx is taken from a <a href="https://stackoverflow.com/questions/201323/how-to-validate-an-email-address-using-a-regular-expression" target="_blank" rel="noopener noreferrer">stackoverflow answer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. For a multi-part bounce message, the body limits to the one of the following parts by content type in descending order</p><ul><li><em>message/delivery-status</em></li><li>html</li><li>plain text</li></ul></li></ul></li><li><p>Change config of cron job <a href="/NotifyBC/preview/docs/config-cronJobs/#delete-notification-bounces" class="">Delete Notification Bounces</a> if needed</p></li></ul><h2 id="list-unsubscribe-by-email" tabindex="-1"><a class="header-anchor" href="#list-unsubscribe-by-email" aria-hidden="true">#</a> List-unsubscribe by Email</h2><p>Some email clients provide a consistent UI to unsubscribe if an unsubscription email address is supplied. For example, newer iOS built-in email app will display following banner</p><img src="/NotifyBC/preview/img/list-unsubscription.png" alt="list unsubscription"><p>To support this unsubscription method, <em>NotifyBC</em> implements a custom inbound SMTP server to transform received emails sent to address <em>un-{subscriptionId}-{unsubscriptionCode}@{inboundSmtpServerDomain}</em> to <em>NotifyBC</em> unsubscribing API calls. This unsubscription email address is generated by <em>NotifyBC</em> and set in header <em>List-Unsubscribe</em> of all notification emails.</p><p>To enable list-unsubscribe by email</p><ul><li>set up <a href="#inbound-smtp-server">inbound smtp server</a></li><li>verify config <em>email.listUnsubscribeByEmail.enabled</em> is set to true or absent in <em>/src/config.local.js</em></li></ul><p>To disable list-unsubscribe by email, set <em>email.listUnsubscribeByEmail.enabled</em> to <em>false</em> in <em>/src/config.local.js</em></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">listUnsubscribeByEmail</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/NotifyBC/preview/docs/config-internalHttpHost/" class="" aria-label="Internal HTTP Host"><!--[--><!--]--> Internal HTTP Host <!--[--><!--]--></a></span><span class="next"><a href="/NotifyBC/preview/docs/config-sms/" class="" aria-label="SMS"><!--[--><!--]--> SMS <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/NotifyBC/preview/assets/app-3a4387b4.js" defer></script>
  </body>
</html>
