import{_ as l,r as o,o as p,c,a as s,b as e,d as n,w as i,e as r}from"./app-f418e719.js";const u={},d=s("h1",{id:"bulk-import",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#bulk-import","aria-hidden":"true"},"#"),e(" Bulk Import")],-1),m={href:"https://www.mongodb.com/docs/database-tools/mongoimport/",target:"_blank",rel:"noopener noreferrer"},h=s("em",null,"NotifyBC",-1),f=s("li",null,[e("Software installed "),s("ul",null,[s("li",null,"Node.js"),s("li",null,"Git")])],-1),b=s("em",null,"NotifyBC",-1),k={href:"https://github.com/bcgov/NotifyBC/tree/main/src/utils/bulk-import/sample-subscription.csv",target:"_blank",rel:"noopener noreferrer"},v=s("em",null,"confirmationRequest.sendRequest",-1),_=r(`<p>To run the utility</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/bcgov/NotifyBC.git
<span class="token builtin class-name">cd</span> NotifyBC
<span class="token function">npm</span> i <span class="token parameter variable">-g</span> <span class="token function">yarn</span> <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> build
<span class="token function">node</span> dist/utils/bulk-import/subscription.js <span class="token parameter variable">-a</span> <span class="token operator">&lt;</span>api-url-prefix<span class="token operator">&gt;</span> <span class="token parameter variable">-c</span> <span class="token operator">&lt;</span>concurrency<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>csv-file-path<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here &lt;csv-file-path&gt; is the path to csv file and &lt;api-url-prefix&gt; is the <em>NotifyBC</em> api url prefix , default to <em>http://localhost:3000/api</em>.</p><p>The script parses the csv file and generates a HTTP post request for each row. The concurrency of HTTP request is controlled by option <em>-c</em> which is default to 10 if omitted. A successful run should output the number of rows imported without any error message</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>success row count = ***
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="field-parsers" tabindex="-1"><a class="header-anchor" href="#field-parsers" aria-hidden="true">#</a> Field Parsers</h3>`,6),g={href:"https://github.com/Keyang/node-csvtojson#custom-parsers",target:"_blank",rel:"noopener noreferrer"},y={href:"https://github.com/bcgov/NotifyBC/tree/main/src/utils/bulk-import/subscription.ts",target:"_blank",rel:"noopener noreferrer"},x=s("em",null,"src/utils/bulk-import/subscription.ts",-1),w=s("em",null,"myCustomIntegerField",-1),C=s("em",null,"colParser",-1),N=r(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token literal-property property">colParser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token punctuation">,</span> <span class="token function-variable function">myCustomIntegerField</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> head<span class="token punctuation">,</span> resultRow<span class="token punctuation">,</span> row<span class="token punctuation">,</span> colIdx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function T(B,I){const t=o("ExternalLinkIcon"),a=o("RouterLink");return p(),c("div",null,[d,s("p",null,[e("To migrate subscriptions from other notification systems, you can use "),s("a",m,[e("mongoimport"),n(t)]),e(". "),h,e(" also provides a utility script to bulk import subscription data from a .csv file. To use the utility, you need")]),s("ul",null,[f,s("li",null,[e("Admin Access to a "),b,e(" instance by adding your client ip to the "),n(a,{to:"/docs/config-adminIpList/"},{default:i(()=>[e("Admin IP List")]),_:1})]),s("li",null,[e("a csv file with header row matching "),n(a,{to:"/docs/api-subscription/#model-schema"},{default:i(()=>[e("subscription model schema")]),_:1}),e(". A sample csv file is "),s("a",k,[e("provided"),n(t)]),e(". Compound fields (of object type) should be dot-flattened as shown in the sample for field "),v])]),_,s("p",null,[e("The utility script takes care of type conversion for built-in fields. If you need to import proprietary fields, by default the fields are imported as strings. To import non-string fields or manipulating json output, you need to define "),s("a",g,[e("custom parsers"),n(t)]),e(" in file "),s("a",y,[x,n(t)]),e(". For example, to parse "),w,e(" to integer, add in the "),C,e(" object")]),N])}const L=l(u,[["render",T],["__file","index.html.vue"]]);export{L as default};
