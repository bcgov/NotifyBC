<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta name="theme-color" content="#3eaf7c"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" type="image/x-icon" href="/NotifyBC/version/6.1/favicon.ico"><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><title>Notification | NotifyBC</title><meta name="description" content="A versatile notification API server">
    <link rel="preload" href="/NotifyBC/version/6.1/assets/style-BwJoByYn.css" as="style"><link rel="stylesheet" href="/NotifyBC/version/6.1/assets/style-BwJoByYn.css">
    <link rel="modulepreload" href="/NotifyBC/version/6.1/assets/app-RlOBjQL3.js"><link rel="modulepreload" href="/NotifyBC/version/6.1/assets/index.html-DvDnEyKt.js">
    <link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-1egVskTM.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-D5dcGZ82.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-qMTSxm7H.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DiSl7KLK.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-lOx30kUT.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CU3-P3SA.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CCF-W79M.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DT-_j3p_.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CtCEDC8G.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-Bo4Hey_u.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-aRpMgjmm.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DH0zE3MZ.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-ZHghRVjV.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-90HFVkv_.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CfOBNBkh.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DI9RwqKy.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CEHkuh0m.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-C6SiB92h.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-5VgRWvqV.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-BWnSLD72.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-C-_TQT9H.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-B3MJ2o-F.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-BqfNZuCx.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DPpgNHXD.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DncIldPC.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-BpuXNMB2.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-Ced8dUHn.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-BZuhKVNb.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-lCNqTtDD.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-C2HZHada.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CLijLNhS.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DYodEkus.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CTnVbhV_.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-BlyeYcMk.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CoRs5CsV.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-CiS0ok6u.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DQpYG7Fr.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-Y9uxF_xZ.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DvcTdnrG.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-DwYzx9oX.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-zuuar6pT.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index.html-Eawj7HMZ.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/filterQueryParam.html-CSw8iMgg.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/filterQueryParamCode.html-ChVYz4ou.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/filterQueryParamExample.html-C27MPgOq.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/jmespathFilter.html-DVY_Tpjj.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/whereQueryParam.html-CdNcK1Qw.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/whereQueryParamCode.html-CLWznD80.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/whereQueryParamExample.html-Db3h88b9.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/404.html-CqgSKPnk.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/index-DjpUunl4.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/mermaid.esm.min-BkNbPx5x.js" as="script"><link rel="prefetch" href="/NotifyBC/version/6.1/assets/setupDevtools-7MC2TMWH-B3XDw3iI.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><!--[--><a class="route-link" href="/NotifyBC/version/6.1/"><img class="vp-site-logo" src="/NotifyBC/version/6.1/img/logo.svg" alt="NotifyBC"></a><!----><!--]--></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/version/6.1/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/NotifyBC/version/6.1/docs/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/version/6.1/help/" aria-label="Help"><!---->Help<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/bcgov/notifybc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/version/6.1/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/NotifyBC/version/6.1/docs/" aria-label="Docs"><!---->Docs<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/NotifyBC/version/6.1/help/" aria-label="Help"><!---->Help<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/bcgov/notifybc" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Getting Started <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/" aria-label="Welcome"><!---->Welcome<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/overview/" aria-label="Overview"><!---->Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/quickstart/" aria-label="Quick Start"><!---->Quick Start<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/installation/" aria-label="Installation"><!---->Installation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/web-console/" aria-label="Web Console"><!---->Web Console<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/what&#39;s-new/" aria-label="What&#39;s New"><!---->What&#39;s New<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Configuration <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-overview/" aria-label="Configuration Overview"><!---->Configuration Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-database/" aria-label="Database"><!---->Database<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-adminIpList/" aria-label="Admin IP List"><!---->Admin IP List<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-reverseProxyIpLists/" aria-label="Reverse Proxy IP Lists"><!---->Reverse Proxy IP Lists<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-httpHost/" aria-label="HTTP Host"><!---->HTTP Host<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-internalHttpHost/" aria-label="Internal HTTP Host"><!---->Internal HTTP Host<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-email/" aria-label="Email"><!---->Email<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-sms/" aria-label="SMS"><!---->SMS<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-subscription/" aria-label="Subscription"><!---->Subscription<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-notification/" aria-label="Notification"><!---->Notification<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-nodeRoles/" aria-label="Node Roles"><!---->Node Roles<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-cronJobs/" aria-label="Cron Jobs"><!---->Cron Jobs<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-rsaKeys/" aria-label="RSA Keys"><!---->RSA Keys<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-workerProcessCount/" aria-label="Worker Process Count"><!---->Worker Process Count<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-middleware/" aria-label="Middleware"><!---->Middleware<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-oidc/" aria-label="OIDC"><!---->OIDC<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-certificates/" aria-label="TLS Certificates"><!---->TLS Certificates<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-queue/" aria-label="Queue"><!---->Queue<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/config-logging/" aria-label="Logging"><!---->Logging<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">API <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/api-overview/" aria-label="API Overview"><!---->API Overview<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/api-subscription/" aria-label="Subscription"><!---->Subscription<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/NotifyBC/version/6.1/docs/api-notification/" aria-label="Notification"><!---->Notification<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/api-config/" aria-label="Configuration"><!---->Configuration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/api-administrator/" aria-label="Administrator"><!---->Administrator<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/api-bounce/" aria-label="Bounce"><!---->Bounce<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Miscellaneous <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/health-check/" aria-label="Health Check"><!---->Health Check<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/disaster-recovery/" aria-label="Disaster Recovery"><!---->Disaster Recovery<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/memory-dump/" aria-label="Memory Dump"><!---->Memory Dump<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/benchmarks/" aria-label="Benchmarks"><!---->Benchmarks<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/bulk-import/" aria-label="Bulk Import"><!---->Bulk Import<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/developer-notes/" aria-label="Developer Notes"><!---->Developer Notes<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/upgrade/" aria-label="Upgrade Guide"><!---->Upgrade Guide<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Meta <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/conduct/" aria-label="Code of Conduct"><!---->Code of Conduct<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/security-reporting/" aria-label="Security Reporting"><!---->Security Reporting<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/NotifyBC/version/6.1/docs/acknowledgments/" aria-label="Acknowledgments"><!---->Acknowledgments<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="notification" tabindex="-1"><a class="header-anchor" href="#notification"><span>Notification</span></a></h1><p>The notification API encapsulates the backend workflow of staging and dispatching a message to targeted user after receiving the message from event source.</p><p>Depending on whether an API call comes from user browser as a user request or from an authorized server application as an admin request, <em>NotifyBC</em> applies different permissions. Admin request allows full CRUD operations. An authenticated user request, on the other hand, are only allowed to get a list of in-app pull notifications targeted to the current user and changing the state of the notifications. An unauthenticated user request can not access any API.</p><p>When a notification is created by the event source server application, the message is saved to database prior to responding to API caller. In addition, for push notification, the message is delivered immediately, i.e. the API call is synchronous. For in-app pull notification, the message, which by default is in state <em>new</em>, can be retrieved later on by browser user request. A user request can only get the list of in-app messages targeted to the current user. A user request can then change the message state to <em>read</em> or <em>deleted</em> depending on user action. A deleted message cannot be retrieved subsequently by user requests, but the state can be updated given the correct <em>id</em>.</p><div class="hint-container warning"><p class="hint-container-title"><i>Deleted</i> message is still kept in database.</p><p><i>NotifyBC</i> provides API for deleting a notification. For the purpose of auditing and recovery, this API only marks the <i>state</i> field as deleted rather than deleting the record from database.</p></div><div class="hint-container tip"><p class="hint-container-title">undo in-app notification deletion within a session</p><p>Because &quot;deleted&quot; message is still kept in database, you can implement undo feature for in-app notification as long as the message id is retained prior to deletion within the current session. To undo, call <a href="#update-a-notification">update</a> API to set desired state.</p></div><p>In-app pull notification also supports message expiration by setting a date in field <em>validTill</em>. An expired message cannot be retrieved by user requests.</p><p>A message, regardless of push or pull, can be unicast or broadcast. A unicast message is intended for an individual user whereas a broadcast message is intended for all confirmed subscribers of a service. A unicast message must have field <em>userChannelId</em> populated. The value of <em>userChannelId</em> is channel dependent. In the case of email for example, this would be user&#39;s email address. A broadcast message must set <em>isBroadcast</em> to true and leave <em>userChannelId</em> empty.</p><div class="hint-container warning"><p class="hint-container-title">Why field <i>isBroadcast</i>?</p><p>Unicast and broadcast message can be distinguished by whether field <i>userChannelId</i> is empty or not alone. So why the extra field <i>isBroadcast</i>? This is in order to prevent inadvertent marking a unicast message broadcast by omitting <i>userChannelId</i> or populating it with empty value. The precaution is necessary because in-app notifications may contain personalized and confidential information.</p></div><p><em>NotifyBC</em> ensures the state of an in-app broadcast message is isolated by user, so that for example, a message read by one user is still new to another user. To achieve this, <em>NotifyBC</em> maintains two internal fields of array type - <em>readBy</em> and <em>deletedBy</em>. When a user request updates the <em>state</em> field of an in-app broadcast message to <em>read</em> or <em>deleted</em>, instead of altering the <em>state</em> field, <em>NotifyBC</em> appends the current user to <em>readBy</em> or <em>deletedBy</em> list. When user request retrieving in-app messages, the <em>state</em> field of the broadcast message in HTTP response is updated based on whether the user exists in field <em>deletedBy</em> and <em>readBy</em>. If existing in both fields, <em>deletedBy</em> takes precedence (the message therefore is not returned). The record in database, meanwhile, is unchanged. Neither field <em>deletedBy</em> nor <em>readBy</em> is visible to user request.</p><h2 id="model-schema" tabindex="-1"><a class="header-anchor" href="#model-schema"><span>Model Schema</span></a></h2><p>The API operates on following notification data model fields:</p><table><tbody><tr><th>Name</th><th>Attributes</th></tr><tr><td><p class="name">id</p><p class="description">notification id</p></td><td><table><tbody><tr><td>type</td><td>string, format depends on db</td></tr><tr><td>auto-generated</td><td>true</td></tr></tbody></table></td></tr><tr><td><p class="name">serviceName</p><p class="description">name of the service</p></td><td><table><tbody><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>true</td></tr></tbody></table></td></tr><tr><td><p class="name">channel</p><p class="description">name of the delivery channel. Valid values: inApp, email, sms.</p></td><td><table><tbody><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>true</td></tr><tr><td>default</td><td>inApp</td></tr></tbody></table></td></tr><tr><td><p class="name">userChannelId</p><p class="description">user&#39;s delivery channel id, for example, email address. For unicast inApp notification, this is authenticated user id. When sending unicast push notification, either <i>userChannelId</i> or <i>userId</i> is required.</p></td><td><table><tbody><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name">userId</p><p class="description">authenticated user id. When sending unicast push notification, either <i>userChannelId</i> or <i>userId</i> is required.</p></td><td><table><tbody><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name">state</p><p class="description">state of notification. Valid values: <i>new</i>, <i>read</i> (inApp only), <i>deleted</i> (inApp only), <i>sent</i> (push only) or <i>error</i>. For inApp broadcast notification, if the user has read or deleted the message, the value of this field retrieved by admin request will still be new. The state for the user is tracked in fields <i>readBy</i> and <i>deletedBy</i> in such case. For user request, the value contains correct state.</p></td><td><table><tbody><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>true</td></tr><tr><td>default</td><td>new</td></tr></tbody></table></td></tr><tr><td><p class="name">created</p><p class="description">date and time of creation</p></td><td><table><tbody><tr><td>type</td><td>date</td></tr><tr><td>auto-generated</td><td>true</td></tr></tbody></table></td></tr><tr><td><p class="name">updated</p><p class="description">date and time of last update</p></td><td><table><tbody><tr><td>type</td><td>date</td></tr><tr><td>auto-generated</td><td>true</td></tr></tbody></table></td></tr><tr><td><p class="name">isBroadcast</p><p class="description">whether it&#39;s a broadcast message. A broadcast message should omit <i>userChannelId</i> and <i>userId</i>, in addition to setting <i>isBroadcast</i> to true</p></td><td><table><tbody><tr><td>type</td><td>boolean</td></tr><tr><td>required</td><td>false</td></tr><tr><td>default</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name">skipSubscriptionConfirmationCheck</p><p class="description">When sending unicast push notification, whether or not to verify if the recipient has a confirmed subscription. This field allows subscription information be kept elsewhere and <i>NotifyBC</i> be used as a unicast push notification gateway only.</p></td><td><table><tbody><tr><td>type</td><td>boolean</td></tr><tr><td>required</td><td>false</td></tr><tr><td>default</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name">validTill</p><p class="description">expiration date-time of the message. Applicable to inApp notification only.</p></td><td><table><tbody><tr><td>type</td><td>date</td></tr><tr><td>required</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name">invalidBefore</p><p class="description">date-time in the future after which the notification can be dispatched.</p></td><td><table><tbody><tr><td>type</td><td>date</td></tr><tr><td>required</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name"><a name="field-message"></a>message</p><div class="description">an object whose child fields are channel dependent: <ul><li><div> for inApp, <i>NotifyBC</i> doesn&#39;t have any restriction as long as web application can handle the message. <i>subject</i> and <i>body</i> are common examples. </div></li><li><div> for email: <i>from, subject, textBody, htmlBody</i></div><ul><li>type: string</li><li> these are email template fields. </li></ul></li><li><div> for sms: <i>textBody</i></div><ul><li>type: string</li><li> sms message template. </li></ul></li></ul><a href="../overview/#mail-merge">Mail merge</a> is performed on email and sms message templates. </div></td><td><table><tbody><tr><td>type</td><td>object</td></tr><tr><td>required</td><td>true</td></tr></tbody></table></td></tr><tr><td><p class="name">httpHost</p><p class="description">This field is used to replace token <i>{http_host}</i> in push notification message template during <a href="../overview/#mail-merge">mail merge</a> and overrides config <i>httpHost</i>.</p></td><td><table><tbody><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr><tr><td>default</td><td>&lt;http protocol, host and port of current request&gt; for push notification</td></tr></tbody></table></td></tr><tr><td><p class="name">asyncBroadcastPushNotification</p><div class="description">this field determines if the API call to create an immediate (i.e. not future-dated) broadcast push notification is asynchronous or not. If omitted, the API call is synchronous, i.e. the API call blocks until notifications to all subscribers have been dispatched. If set, valid values and corresponding behaviors are <ul><li>true - async without callback</li><li>false - sync </li><li>a string containing callback url - async with a POST call to the supplied callback url upon completion</li></ul> When posting to a service with large number of subscribers, it is highly <b>recommended</b> to set the API call to asynchronous, i.e. setting the value to <i>true</i> or supplying a callback. </div></td><td><table><tbody><tr><td>type</td><td>string or boolean</td></tr><tr><td>required</td><td>false</td></tr><tr><td>default</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name"><a name="data"></a>data</p><div class="description">the event that triggers the notification, for example, a RSS feed item when the notification is generated automatically by RSS cron job. Field <i>data</i> serves two purposes <ul><li>to replace <a href="../overview/#dynamic-tokens">dynamic tokens</a> in <i>message</i> template fields</li><li>to match against filter defined in subscription field <a href="../api-subscription#broadcastPushNotificationFilter">broadcastPushNotificationFilter</a>, if supplied, for broadcast push notifications to determine if the notification should be delivered to the subscriber</li></ul></div></td><td><table><tbody><tr><td>type</td><td>object</td></tr><tr><td>required</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name"><a name="broadcastPushNotificationSubscriptionFilter"></a>broadcastPushNotificationSubscriptionFilter</p><div class="description">a string conforming to jmespath <a href="http://jmespath.org/specification.html#filter-expressions">filter expressions syntax</a> after the question mark (?). The filter is matched against the <i><a href="../api-subscription#data">data</a></i> field of the subscription. Examples of filter <ul><li>simple <br><i>province == &#39;BC&#39;</i></li><li>calling jmespath&#39;s <a href="http://jmespath.org/specification.html#built-in-functions">built-in functions</a> <br><i>contains(province,&#39;B&#39;)</i></li><li>calling <a href="../config-notification/#broadcast-push-notification-custom-filter-functions">custom filter functions</a><br><i>contains_ci(province,&#39;b&#39;)</i></li><li>compound <br><i>(contains(province,&#39;BC&#39;) || contains_ci(province,&#39;b&#39;)) &amp;&amp; city == &#39;Victoria&#39; </i></li></ul> All of above filters will match data object <i>{&quot;province&quot;: &quot;BC&quot;, &quot;city&quot;: &quot;Victoria&quot;}</i></div></td><td><table><tbody><tr><td>type</td><td>string</td></tr><tr><td>required</td><td>false</td></tr></tbody></table></td></tr><tr><td><p class="name">readBy</p><p class="description">this is an internal field to track the list of users who have read an inApp broadcast message. It&#39;s not visible to a user request.</p></td><td><table><tbody><tr><td>type</td><td>array</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></tbody></table></td></tr><tr><td><p class="name">deletedBy</p><p class="description">this is an internal field to track the list of users who have marked an inApp broadcast message as deleted. It&#39;s not visible to a user request.</p></td><td><table><tbody><tr><td>type</td><td>array</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></tbody></table></td></tr><tr><td><p class="name">dispatch</p><p class="description">this is an internal field to track the broadcast push notification dispatch outcome. It consists of up to four arrays</p><ul><li>failed - a list of objects containing subscription IDs and error of failed dispatching</li><li>successful - a list of strings containing subscription IDs of successful dispatching</li><li>skipped - a list of strings containing subscription IDs of skipped dispatching</li><li>candidates - a list of strings containing IDs of confirmed subscriptions to the service. Dispatching to a subscription is subject to filtering.</li></ul></td><td><table><tbody><tr><td>type</td><td>object</td></tr><tr><td>required</td><td>false</td></tr><tr><td>auto-generated</td><td>true</td></tr></tbody></table></td></tr></tbody></table><h2 id="get-notifications" tabindex="-1"><a class="header-anchor" href="#get-notifications"><span>Get Notifications</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GET /notifications</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><p>permissions required, one of</p><ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li><p>inputs</p><ul><li><p>a filter containing properties <em>where</em>, <em>fields</em>, <em>order</em>, <em>skip</em>, and <em>limit</em></p><ul><li>parameter name: filter</li><li>required: false</li><li>parameter type: query</li><li>data type: object</li></ul><p>The filter can be expressed as either</p><ol><li>URL-encoded stringified JSON object (see example below); or</li><li>in the format supported by <a href="https://github.com/ljharb/qs" target="_blank" rel="noopener noreferrer">qs</a>, for example <code>?filter[where][created][$gte]=&quot;2023-01-01&quot;&amp;filter[where][created][$lt]=&quot;2024-01-01&quot;</code></li></ol><p>Regardless, the filter will have to be parsed into a JSON object conforming to</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;where&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>...<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;order&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;skip&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>All properties are optional. The syntax for each property is documented, respectively</p><ul><li>for <em>where</em> , see MongoDB <a href="https://www.mongodb.com/docs/manual/tutorial/query-documents/" target="_blank" rel="noopener noreferrer">Query Documents</a></li><li>for <em>fields</em> , see Mongoose <a href="https://mongoosejs.com/docs/api/query.html#Query.prototype.select()" target="_blank" rel="noopener noreferrer">select</a></li><li>for <em>order</em>, see Mongoose <a href="https://mongoosejs.com/docs/api/query.html#Query.prototype.sort()" target="_blank" rel="noopener noreferrer">sort</a></li><li>for <em>skip</em>, see MongoDB <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.skip/" target="_blank" rel="noopener noreferrer">cursor.skip</a></li><li>for <em>limit</em>, see MongoDB <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.limit/" target="_blank" rel="noopener noreferrer">cursor.limit</a></li></ul></li></ul></li><li><p>outcome</p><ul><li>for admin requests, returns unabridged array of notification data matching the filter</li><li>for authenticated user requests, in addition to filter, following constraints are imposed on the returned array <ul><li>only inApp notifications</li><li>only non-deleted notifications. For broadcast notification, non-deleted means not marked by current user as deleted</li><li>only non-expired notifications</li><li>for unicast notifications, only the ones targeted to current user</li><li>if current user is in <em>readBy</em>, then the <em>state</em> is changed to <em>read</em></li><li>the internal field <em>readBy</em> and <em>deletedBy</em> are removed</li></ul></li><li>forbidden to anonymous user requests</li></ul></li><li><p>example</p><p>to retrieve notifications created in year 2023, run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token parameter variable">--header</span> <span class="token string">&#39;Accept: application/json&#39;</span> <span class="token string">&#39;http://localhost:3000/api/notifications?filter=%7B%22where%22%3A%7B%22created%22%3A%7B%22%24gte%22%3A%222023-01-01%22%2C%22%24lt%22%3A%222024-01-01%22%7D%7D%7D&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>the value of the filter query parameter is URL-encoded stringified JSON object</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;where&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;$gte&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-01-01&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;$lt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-01-01&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="get-notification-count" tabindex="-1"><a class="header-anchor" href="#get-notification-count"><span>Get Notification Count</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GET /notifications/count</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><p>permissions required, one of</p><ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li><p>inputs</p><ul><li><p>a <em>where</em> query parameter with value conforming to MongoDB <a href="https://www.mongodb.com/docs/manual/tutorial/query-documents/" target="_blank" rel="noopener noreferrer">Query Documents</a></p><ul><li>parameter name: where</li><li>required: false</li><li>parameter type: query</li><li>data type: object</li></ul><p>The value can be expressed as either</p><ol><li>URL-encoded stringified JSON object (see example below); or</li><li>in the format supported by <a href="https://github.com/ljharb/qs" target="_blank" rel="noopener noreferrer">qs</a>, for example <code>?where[created][$gte]=&quot;2023-01-01&quot;&amp;where[created][$lt]=&quot;2024-01-01&quot;</code></li></ol></li></ul></li><li><p>outcome</p><p>Validations rules are the same as <em>GET /notifications</em>. If passed, the output is a count of notifications matching the query</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;count&quot;</span><span class="token operator">:</span> &lt;number&gt;</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>example</p><p>to retrieve the count of notifications created in year 2023, run</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token parameter variable">--header</span> <span class="token string">&#39;Accept: application/json&#39;</span> <span class="token string">&#39;http://localhost:3000/api/notifications/count?where=%7B%22created%22%3A%7B%22%24gte%22%3A%222023-01-01%22%2C%22%24lt%22%3A%222024-01-01%22%7D%7D&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>the value of the <em>where</em> query parameter is URL-encoded stringified JSON object</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;$gte&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2023-01-01&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;$lt&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2024-01-01&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="create-send-notifications" tabindex="-1"><a class="header-anchor" href="#create-send-notifications"><span>Create/Send Notifications</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">POST /notifications</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><p>permissions required, one of</p><ul><li>super admin</li><li>admin</li></ul></li><li><p>inputs</p><ul><li>an object containing notification data model fields. At a minimum all required fields that don&#39;t have a default value must be supplied. Id field should be omitted since it&#39;s auto-generated. The API explorer only created an empty object for field <em>message</em> but you should populate the child fields according to <a href="#model-schema">model schema</a><ul><li>parameter name: data</li><li>required: true</li><li>parameter type: body</li><li>data type: object</li></ul></li></ul></li><li><p>outcome</p><p><em>NotifyBC</em> performs following actions in sequence</p><ol><li><p>if it&#39;s a user request, error is returned</p></li><li><p>inputs are validated. If validation fails, error is returned. In particular, for unicast push notification, the recipient as identified by either <em>userChannelId</em> or <em>userId</em> must have a confirmed subscription if field <em>skipSubscriptionConfirmationCheck</em> is not set to true. If <em>skipSubscriptionConfirmationCheck</em> is set to true, then the subscription check is skipped, but in such case the request must contain <em>userChannelId</em>, not <em>userId</em> as subscription data is not queried to obtain <em>userChannelId</em> from <em>userId</em>.</p></li><li><p>for push notification, if field <em>httpHost</em> is empty, it is populated based on request&#39;s http protocol and host.</p></li><li><p>the notification request is saved to database</p></li><li><p>if the notification is future-dated, then all subsequent request processing is skipped and response is sent back to user. Steps 7-11 below will be carried out later on by the cron job when the notification becomes current.</p></li><li><p>if it&#39;s an async broadcast push notification, then response is sent back to user but steps 7-12 below is processed separately</p></li><li><p>for unicast push notification, the message is dispatched to targeted user; for broadcast push notification, following actions are performed:</p><ol><li><p>number of confirmed subscriptions is retrieved</p></li><li><p>the subscriptions are partitioned and processed concurrently as described in config section <a class="route-link" href="/NotifyBC/version/6.1/docs/config-notification/#broadcast-push-notification-task-concurrency">Broadcast Push Notification Task Concurrency</a></p></li><li><p>when processing an individual subscription,</p><ol><li>if the subscription has filter rule defined in field <em>broadcastPushNotificationFilter</em> and notification contains field <em>data</em>, then the data is matched against the filter rule. Notification message is only dispatched if there is a match.</li><li>if the notification has filter rule defined in field <em>broadcastPushNotificationSubscriptionFilter</em> and subscription contains field <em>data</em>, then the data is matched against the filter rule. Notification message is only dispatched if there is a match.</li></ol><p>If the subscription failed to pass any of the two filters, and if both <em>guaranteedBroadcastPushDispatchProcessing</em> and <em>logSkippedBroadcastPushDispatches</em> are true, the subscription id is logged to <em>dispatch.skipped</em></p></li></ol><p>Regardless of unicast or broadcast, mail merge is performed on messages before dispatching.</p></li><li><p>the state of push notification is updated to <em>sent</em> or <em>error</em> depending on sending status. For broadcast push notification, the dispatching could be failed only for a subset of users. In such case, the field <em>dispatch.failed</em> contains a list of objects of {userChannelId, subscriptionId, error} the message failed to deliver to, but the state will still be set to <em>sent</em>.</p></li><li><p>For broadcast push notifications, if <em>guaranteedBroadcastPushDispatchProcessing</em> is <em>true</em>, then field <em>dispatch.successful</em> is populated with a list of <em>subscriptionId</em> of the successful dispatches.</p></li><li><p>For push notifications, the bounce records of successful dispatches are updated</p></li><li><p>the updated notification is saved back to database</p></li><li><p>if it&#39;s an async broadcast push notification with a callback url, then the url is called with POST verb containing the notification with updated status as the request body</p></li><li><p>for synchronous notification, the saved record is returned unless there is an error saving to database, in which case error is returned</p></li></ol></li><li><p>example</p><p>To send a unicast email push notification, copy and paste following json object to the data value box in API explorer, change email addresses as needed, and click <em>Try it out!</em> button:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;serviceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;education&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;userChannelId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo@bar.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;skipSubscriptionConfirmationCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no_reply@bar.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;subject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;textBody&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is a test&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;channel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As the result, <em>foo@bar.com</em> should receive an email notification even if the user is not a confirmed subscriber, and following json object is returned to caller upon sending the email successfully:</p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;serviceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;education&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sent&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;userChannelId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo@bar.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;skipSubscriptionConfirmationCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;from&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no_reply@bar.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;subject&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;textBody&quot;</span><span class="token operator">:</span> <span class="token string">&quot;This is a test&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;created&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2016-09-30T20:37:06.011Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;updated&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2016-09-30T20:37:06.011Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;channel&quot;</span><span class="token operator">:</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;isBroadcast&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;57eeccf23427b61a4820775e&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="update-a-notification" tabindex="-1"><a class="header-anchor" href="#update-a-notification"><span>Update a Notification</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">PATCH /notifications/{id}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This API is mainly used for updating an inApp notification.</p><ul><li><p>permissions required, one of</p><ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li><p>inputs</p><ul><li>notification id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li><li>an object containing fields to be updated. <ul><li>parameter name: data</li><li>required: true</li><li>parameter type: body</li><li>data type: object</li></ul></li></ul></li><li><p>outcome</p><ul><li>for user requests, <em>NotifyBC</em> performs following actions in sequence <ol><li>for unicast notification, if the notification is not targeted to current user, error is returned</li><li>all fields except for <em>state</em> are discarded from the input</li><li>for broadcast notification, current user id in appended to array <em>readBy</em> or <em>deletedBy</em>, depending on whether <em>state</em> is <em>read</em> or <em>deleted</em>, unless the user id is already in the array. The <em>state</em> field itself is then discarded</li><li>the notification identified by <em>id</em> is merged with the updates and saved to database</li><li>HTTP response code 204 is returned, unless there is error.</li></ol></li><li>admin requests are allowed to update any field</li></ul></li></ul><h2 id="delete-a-notification" tabindex="-1"><a class="header-anchor" href="#delete-a-notification"><span>Delete a Notification</span></a></h2><p>This API is mainly used for marking an inApp notification deleted. It has the same effect as updating a notification with state set to <em>deleted</em>.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">DELETE /notifications/{id}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>permissions required, one of <ul><li>super admin</li><li>admin</li><li>authenticated user</li></ul></li><li>inputs <ul><li>notification id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li></ul></li><li>outcome: same as the outcome of <a href="#update-a-notification">Update a Notification</a> with <em>state</em> set to <em>deleted</em>.</li></ul><h2 id="replace-a-notification" tabindex="-1"><a class="header-anchor" href="#replace-a-notification"><span>Replace a Notification</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">PUT /notifications/{id}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This API is intended to be only used by admin web console to modify a notification in <em>new</em> state. Notifications in such state are typically future-dated or of channel <em>in-app</em>.</p><ul><li><p>permissions required, one of</p><ul><li>super admin</li><li>admin</li></ul></li><li><p>inputs</p><ul><li>notification id <ul><li>parameter name: id</li><li>required: true</li><li>parameter type: path</li><li>data type: string</li></ul></li><li>notification data <ul><li>parameter name: data</li><li>required: true</li><li>parameter type: body</li><li>data type: object</li></ul></li></ul></li><li><p>outcome</p><p><em>NotifyBC</em> process the request same way as <a href="#create-send-notifications">Create/Send Notifications</a> except that notification data is saved with <em>id</em> supplied in the parameter, replacing existing one.</p></li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/NotifyBC/version/6.1/docs/api-subscription/" aria-label="Subscription"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Subscription</span></div></a><a class="route-link auto-link next" href="/NotifyBC/version/6.1/docs/api-config/" aria-label="Configuration"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Configuration</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/NotifyBC/version/6.1/assets/app-RlOBjQL3.js" defer></script>
  </body>
</html>
